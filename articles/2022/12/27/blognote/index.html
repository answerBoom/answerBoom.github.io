<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Blogç¬”è®° | ğŸ» liyBlog</title>
<meta name="keywords" content="Java">
<meta name="description" content="blogé¡¹ç›®ç¬”è®° mybatis plus 1. ç±»æ³¨è§£ @Data @NoArgsConstructor @AllArgsConstructor @TableName(&#34;sg_article&#34;) @Accessors(chain = true) public class Article{ } @Dataï¼šæ³¨åœ¨ç±»ä¸Šï¼Œæä¾›ç±»çš„getã€setã€equalsã€hashCodeã€toStringæ–¹æ³•
@NoArgsConstructorï¼šæä¾›ç±»çš„æ— å‚æ„é€ 
@AllArgsConstructorï¼šæä¾›ç±»çš„å…¨å‚æ„é€ 
@TableName(&quot;sg_article&quot;)ï¼šå°†è¡¨ä¸æ•°æ®åº“é‡Œçš„è¡¨å¯¹åº”èµ·æ¥
@Accessors(chain = true)ï¼šå°†getã€setæ–¹æ³•çš„è¿”å›ç±»å‹è®¾ç½®ä¸ºå®ä½“ç±»å¯¹è±¡ï¼Œä»£æ›¿äº†é»˜è®¤çš„è¿”å›void
å®ä½“ç±»ä¸­åŠ å…¥æ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„åˆ—åéœ€è¦åŠ å…¥TableFieldæ³¨è§£æ ‡è¯†
@TableField(exist = false) private String categoryName; 2. mybatis plusä¸­wapperæ–¹æ³• queryWapper.eqï¼ˆå­—æ®µåï¼Œvalï¼‰
å­—æ®µåå¯ä»¥ç”¨å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ç”¨æ–¹æ³•ï¼šArticle::getStatus
æ¨èç”¨æ–¹æ³•é˜²æ­¢åˆ—åå†™é”™
lambdaQueryWrapper.eq(Objects.nonNull(categoryId) &amp;&amp; categoryId &gt; 0, Article::getCategoryId, categoryId);
eqæ–¹æ³•ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªbooleanä¸ºtrueæ—¶å¼•å…¥åŠ å…¥åä¸¤ä¸ªå‚æ•°æ¡ä»¶ï¼Œä¸ºfalseæ—¶ä¸åŠ å…¥
3. ä½¿ç”¨pageåˆ†é¡µéœ€è¦é…ç½®åˆ†é¡µæ’ä»¶ï¼Œåœ¨configåŒ…ä¸‹åŠ å…¥ä»¥ä¸‹ç±» @Configuration public class MbatisPlusConfig { /** * 3.4.0ä¹‹åç‰ˆæœ¬ * @return */ @Bean public MybatisPlusInterceptor mybatisPlusInterceptor(){ MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor(); mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor()); return mybatisPlusInterceptor; } } 4ã€å…¬å…±å­—æ®µå¡«å…… æ’å…¥æ—¶é—´ã€æ›´æ–°æ—¶é—´çš„è‡ªåŠ¨å¡«å……">
<meta name="author" content="">
<link rel="canonical" href="answerboom.github.io/articles/2022/12/27/blognote/">
<link crossorigin="anonymous" href="/answerboom.github.io/assets/css/stylesheet.f1ce240cfe5af969a7d47c7624c2a49eda79c4e4fd31a81b2d14d80a5fbc3546.css" integrity="" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/answerboom.github.io/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="answerboom.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="answerboom.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="answerboom.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="answerboom.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="answerboom.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Blogç¬”è®°" />
<meta property="og:description" content="blogé¡¹ç›®ç¬”è®° mybatis plus 1. ç±»æ³¨è§£ @Data @NoArgsConstructor @AllArgsConstructor @TableName(&#34;sg_article&#34;) @Accessors(chain = true) public class Article{ } @Dataï¼šæ³¨åœ¨ç±»ä¸Šï¼Œæä¾›ç±»çš„getã€setã€equalsã€hashCodeã€toStringæ–¹æ³•
@NoArgsConstructorï¼šæä¾›ç±»çš„æ— å‚æ„é€ 
@AllArgsConstructorï¼šæä¾›ç±»çš„å…¨å‚æ„é€ 
@TableName(&quot;sg_article&quot;)ï¼šå°†è¡¨ä¸æ•°æ®åº“é‡Œçš„è¡¨å¯¹åº”èµ·æ¥
@Accessors(chain = true)ï¼šå°†getã€setæ–¹æ³•çš„è¿”å›ç±»å‹è®¾ç½®ä¸ºå®ä½“ç±»å¯¹è±¡ï¼Œä»£æ›¿äº†é»˜è®¤çš„è¿”å›void
å®ä½“ç±»ä¸­åŠ å…¥æ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„åˆ—åéœ€è¦åŠ å…¥TableFieldæ³¨è§£æ ‡è¯†
@TableField(exist = false) private String categoryName; 2. mybatis plusä¸­wapperæ–¹æ³• queryWapper.eqï¼ˆå­—æ®µåï¼Œvalï¼‰
å­—æ®µåå¯ä»¥ç”¨å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ç”¨æ–¹æ³•ï¼šArticle::getStatus
æ¨èç”¨æ–¹æ³•é˜²æ­¢åˆ—åå†™é”™
lambdaQueryWrapper.eq(Objects.nonNull(categoryId) &amp;&amp; categoryId &gt; 0, Article::getCategoryId, categoryId);
eqæ–¹æ³•ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªbooleanä¸ºtrueæ—¶å¼•å…¥åŠ å…¥åä¸¤ä¸ªå‚æ•°æ¡ä»¶ï¼Œä¸ºfalseæ—¶ä¸åŠ å…¥
3. ä½¿ç”¨pageåˆ†é¡µéœ€è¦é…ç½®åˆ†é¡µæ’ä»¶ï¼Œåœ¨configåŒ…ä¸‹åŠ å…¥ä»¥ä¸‹ç±» @Configuration public class MbatisPlusConfig { /** * 3.4.0ä¹‹åç‰ˆæœ¬ * @return */ @Bean public MybatisPlusInterceptor mybatisPlusInterceptor(){ MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor(); mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor()); return mybatisPlusInterceptor; } } 4ã€å…¬å…±å­—æ®µå¡«å…… æ’å…¥æ—¶é—´ã€æ›´æ–°æ—¶é—´çš„è‡ªåŠ¨å¡«å……" />
<meta property="og:type" content="article" />
<meta property="og:url" content="answerboom.github.io/articles/2022/12/27/blognote/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-27T17:16:20+08:00" />
<meta property="article:modified_time" content="2022-12-27T17:16:20+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Blogç¬”è®°"/>
<meta name="twitter:description" content="blogé¡¹ç›®ç¬”è®° mybatis plus 1. ç±»æ³¨è§£ @Data @NoArgsConstructor @AllArgsConstructor @TableName(&#34;sg_article&#34;) @Accessors(chain = true) public class Article{ } @Dataï¼šæ³¨åœ¨ç±»ä¸Šï¼Œæä¾›ç±»çš„getã€setã€equalsã€hashCodeã€toStringæ–¹æ³•
@NoArgsConstructorï¼šæä¾›ç±»çš„æ— å‚æ„é€ 
@AllArgsConstructorï¼šæä¾›ç±»çš„å…¨å‚æ„é€ 
@TableName(&quot;sg_article&quot;)ï¼šå°†è¡¨ä¸æ•°æ®åº“é‡Œçš„è¡¨å¯¹åº”èµ·æ¥
@Accessors(chain = true)ï¼šå°†getã€setæ–¹æ³•çš„è¿”å›ç±»å‹è®¾ç½®ä¸ºå®ä½“ç±»å¯¹è±¡ï¼Œä»£æ›¿äº†é»˜è®¤çš„è¿”å›void
å®ä½“ç±»ä¸­åŠ å…¥æ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„åˆ—åéœ€è¦åŠ å…¥TableFieldæ³¨è§£æ ‡è¯†
@TableField(exist = false) private String categoryName; 2. mybatis plusä¸­wapperæ–¹æ³• queryWapper.eqï¼ˆå­—æ®µåï¼Œvalï¼‰
å­—æ®µåå¯ä»¥ç”¨å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ç”¨æ–¹æ³•ï¼šArticle::getStatus
æ¨èç”¨æ–¹æ³•é˜²æ­¢åˆ—åå†™é”™
lambdaQueryWrapper.eq(Objects.nonNull(categoryId) &amp;&amp; categoryId &gt; 0, Article::getCategoryId, categoryId);
eqæ–¹æ³•ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªbooleanä¸ºtrueæ—¶å¼•å…¥åŠ å…¥åä¸¤ä¸ªå‚æ•°æ¡ä»¶ï¼Œä¸ºfalseæ—¶ä¸åŠ å…¥
3. ä½¿ç”¨pageåˆ†é¡µéœ€è¦é…ç½®åˆ†é¡µæ’ä»¶ï¼Œåœ¨configåŒ…ä¸‹åŠ å…¥ä»¥ä¸‹ç±» @Configuration public class MbatisPlusConfig { /** * 3.4.0ä¹‹åç‰ˆæœ¬ * @return */ @Bean public MybatisPlusInterceptor mybatisPlusInterceptor(){ MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor(); mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor()); return mybatisPlusInterceptor; } } 4ã€å…¬å…±å­—æ®µå¡«å…… æ’å…¥æ—¶é—´ã€æ›´æ–°æ—¶é—´çš„è‡ªåŠ¨å¡«å……"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Blogç¬”è®°",
      "item": "answerboom.github.io/articles/2022/12/27/blognote/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Blogç¬”è®°",
  "name": "Blogç¬”è®°",
  "description": "blogé¡¹ç›®ç¬”è®° mybatis plus 1. ç±»æ³¨è§£ @Data @NoArgsConstructor @AllArgsConstructor @TableName(\u0026#34;sg_article\u0026#34;) @Accessors(chain = true) public class Article{ } @Dataï¼šæ³¨åœ¨ç±»ä¸Šï¼Œæä¾›ç±»çš„getã€setã€equalsã€hashCodeã€toStringæ–¹æ³•\n@NoArgsConstructorï¼šæä¾›ç±»çš„æ— å‚æ„é€ \n@AllArgsConstructorï¼šæä¾›ç±»çš„å…¨å‚æ„é€ \n@TableName(\u0026quot;sg_article\u0026quot;)ï¼šå°†è¡¨ä¸æ•°æ®åº“é‡Œçš„è¡¨å¯¹åº”èµ·æ¥\n@Accessors(chain = true)ï¼šå°†getã€setæ–¹æ³•çš„è¿”å›ç±»å‹è®¾ç½®ä¸ºå®ä½“ç±»å¯¹è±¡ï¼Œä»£æ›¿äº†é»˜è®¤çš„è¿”å›void\nå®ä½“ç±»ä¸­åŠ å…¥æ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„åˆ—åéœ€è¦åŠ å…¥TableFieldæ³¨è§£æ ‡è¯†\n@TableField(exist = false) private String categoryName; 2. mybatis plusä¸­wapperæ–¹æ³• queryWapper.eqï¼ˆå­—æ®µåï¼Œvalï¼‰\nå­—æ®µåå¯ä»¥ç”¨å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ç”¨æ–¹æ³•ï¼šArticle::getStatus\næ¨èç”¨æ–¹æ³•é˜²æ­¢åˆ—åå†™é”™\nlambdaQueryWrapper.eq(Objects.nonNull(categoryId) \u0026amp;\u0026amp; categoryId \u0026gt; 0, Article::getCategoryId, categoryId);\neqæ–¹æ³•ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªbooleanä¸ºtrueæ—¶å¼•å…¥åŠ å…¥åä¸¤ä¸ªå‚æ•°æ¡ä»¶ï¼Œä¸ºfalseæ—¶ä¸åŠ å…¥\n3. ä½¿ç”¨pageåˆ†é¡µéœ€è¦é…ç½®åˆ†é¡µæ’ä»¶ï¼Œåœ¨configåŒ…ä¸‹åŠ å…¥ä»¥ä¸‹ç±» @Configuration public class MbatisPlusConfig { /** * 3.4.0ä¹‹åç‰ˆæœ¬ * @return */ @Bean public MybatisPlusInterceptor mybatisPlusInterceptor(){ MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor(); mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor()); return mybatisPlusInterceptor; } } 4ã€å…¬å…±å­—æ®µå¡«å…… æ’å…¥æ—¶é—´ã€æ›´æ–°æ—¶é—´çš„è‡ªåŠ¨å¡«å……",
  "keywords": [
    "Java"
  ],
  "articleBody": "blogé¡¹ç›®ç¬”è®° mybatis plus 1. ç±»æ³¨è§£ @Data @NoArgsConstructor @AllArgsConstructor @TableName(\"sg_article\") @Accessors(chain = true) public class Article{ } @Dataï¼šæ³¨åœ¨ç±»ä¸Šï¼Œæä¾›ç±»çš„getã€setã€equalsã€hashCodeã€toStringæ–¹æ³•\n@NoArgsConstructorï¼šæä¾›ç±»çš„æ— å‚æ„é€ \n@AllArgsConstructorï¼šæä¾›ç±»çš„å…¨å‚æ„é€ \n@TableName(\"sg_article\")ï¼šå°†è¡¨ä¸æ•°æ®åº“é‡Œçš„è¡¨å¯¹åº”èµ·æ¥\n@Accessors(chain = true)ï¼šå°†getã€setæ–¹æ³•çš„è¿”å›ç±»å‹è®¾ç½®ä¸ºå®ä½“ç±»å¯¹è±¡ï¼Œä»£æ›¿äº†é»˜è®¤çš„è¿”å›void\nå®ä½“ç±»ä¸­åŠ å…¥æ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„åˆ—åéœ€è¦åŠ å…¥TableFieldæ³¨è§£æ ‡è¯†\n@TableField(exist = false) private String categoryName; 2. mybatis plusä¸­wapperæ–¹æ³• queryWapper.eqï¼ˆå­—æ®µåï¼Œvalï¼‰\nå­—æ®µåå¯ä»¥ç”¨å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ç”¨æ–¹æ³•ï¼šArticle::getStatus\næ¨èç”¨æ–¹æ³•é˜²æ­¢åˆ—åå†™é”™\nlambdaQueryWrapper.eq(Objects.nonNull(categoryId) \u0026\u0026 categoryId \u003e 0, Article::getCategoryId, categoryId);\neqæ–¹æ³•ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªbooleanä¸ºtrueæ—¶å¼•å…¥åŠ å…¥åä¸¤ä¸ªå‚æ•°æ¡ä»¶ï¼Œä¸ºfalseæ—¶ä¸åŠ å…¥\n3. ä½¿ç”¨pageåˆ†é¡µéœ€è¦é…ç½®åˆ†é¡µæ’ä»¶ï¼Œåœ¨configåŒ…ä¸‹åŠ å…¥ä»¥ä¸‹ç±» @Configuration public class MbatisPlusConfig { /** * 3.4.0ä¹‹åç‰ˆæœ¬ * @return */ @Bean public MybatisPlusInterceptor mybatisPlusInterceptor(){ MybatisPlusInterceptor mybatisPlusInterceptor = new MybatisPlusInterceptor(); mybatisPlusInterceptor.addInnerInterceptor(new PaginationInnerInterceptor()); return mybatisPlusInterceptor; } } 4ã€å…¬å…±å­—æ®µå¡«å…… æ’å…¥æ—¶é—´ã€æ›´æ–°æ—¶é—´çš„è‡ªåŠ¨å¡«å……\n1ã€åœ¨å®ä½“ç±»çš„å±æ€§ä¸ŠåŠ å…¥@TableFieldæ³¨è§£ï¼ŒæŒ‡å®šè‡ªåŠ¨å¡«å……çš„ç­–ç•¥\n2ã€æŒ‰ç…§æ¡†æ¶è¦æ±‚ç¼–å†™å…ƒæ•°æ®å¯¹è±¡å¤„ç†å™¨ï¼Œåœ¨æ­¤ç±»ä¸­ç»Ÿä¸€ä¸ºå…¬å…±å­—æ®µèµ‹å€¼ï¼Œæ­¤ç±»éœ€è¦å®ç°MetaObjectHandleræ¥å£\n@TableField(fill=FieldFill.INSERT) private LocalDateTime createTime; @TableField(fill=FieldFill.INSERT_UPDATE) private LocalDateTime updateTime; @Component public class MyMetaObjectHandler implements MetaObjectHandler { @Override public void insertFill(MetaObject metaObject) { metaObject.setValue(\"createTime\", LocalDateTime.now()); metaObject.setValue(\"updateTime\", LocalDateTime.now()); metaObject.setValue(\"createUser\",new Long(1)); metaObject.setValue(\"updateUser\",new Long(1)); } @Override public void updateFill(MetaObject metaObject) { metaObject.setValue(\"updateTime\", LocalDateTime.now()); metaObject.setValue(\"updateUser\",new Long(1)); } } 5ã€@Transactional â€‹\tæ¶‰åŠå¤šå¼ è¡¨æ“ä½œçš„æ–¹æ³•éœ€è¦åŠ å…¥@Transactionalæ³¨è§£ï¼Œå¹¶åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableTransactionManagementæ³¨è§£\nStremæµ 1.mapã€filter Streamæµä¸­ï¼Œmapå¯ä»¥å°†ä¸€ä¸ªæµçš„å…ƒç´ æŒ‰ç…§ä¸€å®šçš„æ˜ å°„è§„åˆ™æ˜ å°„åˆ°å¦ä¸€ä¸ªæµä¸­ã€‚\npublic static \u003cO,T\u003e List\u003cT\u003e copyBeanList(List\u003cO\u003e list,Class\u003cT\u003e clazz) { return list.stream() .map(o -\u003e copyBean(o,clazz)).collect(Collectors.toList()); } lambdaæ˜¯å¯¹åŒ¿åå†…éƒ¨ç±»çš„ä¸€ç§ç®€å†™\ncategories = categories.stream().filter(new Predicate\u003cCategory\u003e() { @Override public boolean test(Category category) { return SystemConstants.STATUS_NORMAL.equals(category.getStatus()); } }).collect(Collectors.toList()); ç®€å†™å\nList\u003ccategory\u003e categories = categories.stream().filter(category -\u003e SystemConstants.STATUS_NORMAL.equals(category.getStatus())).collect(Collectors.toList()); filterè¿‡æ»¤æ‰ä¸æ»¡è¶³è¡¨è¾¾å¼çš„å…ƒç´ \ncollectæ“ä½œå¯ä»¥æ¥å—å„ç§æ–¹æ³•ä½œä¸ºå‚æ•°ï¼Œå°†æµä¸­çš„å…ƒç´ æ±‡é›†ã€‚\n2.æ¼”å˜è¿‡ç¨‹ å°†åˆ†ç±»è¡¨nameæ ¹æ®categoryIdèµ‹å€¼ç»™Articleçš„categoryName\nä½¿ç”¨åŒ¿åå†…éƒ¨ç±»\narticles.stream().map(new Function() { @Override public Article apply(Article article) { //è·å–åˆ†ç±»idï¼ŒæŸ¥è¯¢åˆ†ç±»ä¿¡æ¯ï¼Œè·å–åˆ†ç±»åç§° Category category = categoryService.getById(article.getCategoryId()); String name = category.getName(); article.setCategoryName(name); return article; } }) ä½¿ç”¨lambdaè¡¨è¾¾å¼\nåªå…³æ³¨å‚æ•°åˆ—è¡¨å’Œæ–¹æ³•ä½“\n(Article article) { //è·å–åˆ†ç±»idï¼ŒæŸ¥è¯¢åˆ†ç±»ä¿¡æ¯ï¼Œè·å–åˆ†ç±»åç§° Category category = categoryService.getById(article.getCategoryId()); String name = category.getName(); article.setCategoryName(name); return article; } å‚æ•°åˆ—è¡¨å’Œæ–¹æ³•ä½“ç”¨ä¸€ä¸ªç®­å¤´ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°åˆ™å‚æ•°ç±»å‹ã€å°æ‹¬å·å¯ä»¥çœç•¥ï¼Œå¤§æ‹¬å·å’Œreturnå¯ä»¥å»æ‰\narticles.stream().map(article -\u003e Category category = categoryService.getById(article.getCategoryId()); String name = category.getName(); article.setCategoryName(name); return article; ) ç®€åŒ–å®Œæˆå\narticles = articles.stream() .map(article -\u003e article.setCategoryName(categoryService.getById(article.getCategoryId()).getName())).collect(Collectors.toList()); Spring Security åŠ å…¥ä¾èµ–\n\u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-security\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.springframework.boot\u003c/groupId\u003e \u003cartifactId\u003espring-boot-starter-data-redis\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.alibaba\u003c/groupId\u003e \u003cartifactId\u003efastjson\u003c/artifactId\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eio.jsonwebtoken\u003c/groupId\u003e \u003cartifactId\u003ejjwt\u003c/artifactId\u003e \u003c/dependency\u003e åŠ å…¥å·¥å…·ç±»å’Œé…ç½®\nç™»å½• â€‹\tâ‘ è‡ªå®šä¹‰ç™»å½•æ¥å£\nâ€‹\tè°ƒç”¨ProviderManagerçš„æ–¹æ³•è¿›è¡Œè®¤è¯ å¦‚æœè®¤è¯é€šè¿‡ç”Ÿæˆjwt\nâ€‹\tæŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redisä¸­\nâ€‹\tâ‘¡è‡ªå®šä¹‰UserDetailsService\nâ€‹\tåœ¨è¿™ä¸ªå®ç°ç±»ä¸­å»æŸ¥è¯¢æ•°æ®åº“\nâ€‹\tæ³¨æ„é…ç½®passwordEncoderä¸ºBCryptPasswordEncoder\nå°†authenticationManageræ³¨å…¥å®¹å™¨\n@Autowired private AuthenticationManager authenticationManager; æ­¤æ—¶è¿˜å®¹å™¨ä¸­è¿˜æ²¡æœ‰authenticationManagerï¼Œéœ€è¦åœ¨é…ç½®ç±»ä¸­é…ç½®\n@Configuration public class SecurityConfig extends WebSecurityConfigurerAdapter { /** *è¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªAuthenticationManagerçš„å¯¹è±¡ *é€šè¿‡beanæ³¨è§£æ³¨å…¥å®¹å™¨ */ @Bean @Override public AuthenticationManager authenticationManagerBean() throws Exception { return super.authenticationManagerBean(); } } è°ƒç”¨authenticationManagerçš„authenticateçš„æ–¹æ³•ï¼Œä½†æ˜¯authenticateä¼šè°ƒç”¨UserDetailsServiceçš„è‡ªå¸¦æ–¹æ³•ï¼ˆéœ€è¦é‡å†™ï¼‰å»è®¿é—®å†…å­˜ï¼Œå®é™…éœ€æ±‚éœ€è¦å»è®¿é—®æ•°æ®åº“\n@Service public class UserDetailsServiceImpl implements UserDetailsService { @Autowired private UserMapper userMapper; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { //æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ LambdaQueryWrapper\u003cUser\u003e lambdaQueryWrapper = new LambdaQueryWrapper(); lambdaQueryWrapper.eq(User::getUserName, username); User user = userMapper.selectOne(lambdaQueryWrapper); //åˆ¤æ–­æ˜¯å¦æŸ¥åˆ°ç”¨æˆ·ï¼Œå¦‚æœæ²¡æŸ¥åˆ°æŠ›å‡ºå¼‚å¸¸ if (Objects.isNull(user)) { throw new RuntimeException(\"ç”¨æˆ·ä¸å­˜åœ¨\"); } //è¿”å›ç”¨æˆ·ä¿¡æ¯ //TODO æŸ¥è¯¢æƒé™ä¿¡æ¯å°è£… //LoginUseræ˜¯UserDetailsçš„å®ç°ç±» return new LoginUser(user); } } é€šè¿‡serviceæ³¨è§£æ³¨å…¥å®¹å™¨å¯ä»¥å®ç°æ›¿æ¢åŸæ¥çš„æ–¹æ³•å®ç°æ ¡éªŒ\nè°ƒç”¨å®Œauthenticateä¼šè¿”å›authenticateå¯¹è±¡ï¼Œç»§ç»­å®ç°loginçš„æ–¹æ³•\n@Service public class BlogLoginServiceImpl implements BlogLoginService { @Autowired private AuthenticationManager authenticationManager; @Autowired private RedisCache redisCache; @Override public ResponseResult login(User user) { UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken = new UsernamePasswordAuthenticationToken(user.getUserName(), user.getPassword()); Authentication authenticate = authenticationManager.authenticate(usernamePasswordAuthenticationToken); //åˆ¤æ–­æ˜¯å¦è®¤è¯é€šè¿‡ if (Objects.isNull(authenticate)) { throw new RuntimeException(\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\"); } //è·å–useridç”Ÿæˆtoken //getPrincipalæ˜¯è·å–authenticateçš„ä¸»ä½“ï¼Œé‡Œé¢å°è£…äº†ä¹‹å‰ä¼ å…¥çš„loginUser LoginUser loginUser = (LoginUser) authenticate.getPrincipal(); String userId = loginUser.getUser().getId().toString(); //å°†useridåŠ å¯†æˆjwt String jwt = JwtUtil.createJWT(userId); //æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redis redisCache.setCacheObject(\"bolglogin:\"+userId,loginUser); //æŠŠtokenå’Œuserinfoå°è£…è¿”å› //æŠŠUserè½¬æ¢æˆUserInfoVo UserInfoVo userInfoVo = BeanCopyUtils.copyBean(loginUser.getUser(), UserInfoVo.class); BlogUserLoginVo vo = new BlogUserLoginVo(jwt,userInfoVo); return ResponseResult.okResult(vo); } } é…ç½®securityé…ç½®ç±»\n@Override protected void configure(HttpSecurity http) throws Exception { http //å…³é—­csrf .csrf().disable() //ä¸é€šè¿‡Sessionè·å–SecurityContext .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and() .authorizeRequests() // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—® .antMatchers(\"/login\").anonymous() //jwtè¿‡æ»¤å™¨æµ‹è¯•ç”¨ï¼Œå¦‚æœæµ‹è¯•æ²¡æœ‰é—®é¢˜å§è¿™é‡Œåˆ é™¤äº† .antMatchers(\"/link/getAllLink\").authenticated() // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨ä¸éœ€è¦è®¤è¯å³å¯è®¿é—® .anyRequest().permitAll(); http.logout().disable(); //å…è®¸è·¨åŸŸ http.cors(); } @Bean public PasswordEncoder passwordEncoder(){ return new BCryptPasswordEncoder(); } ç™»é™†æ ¡éªŒè¿‡æ»¤å™¨ â€‹\tâ‘ å®šä¹‰Jwtè®¤è¯è¿‡æ»¤å™¨\nâ€‹\tè·å–token\nâ€‹\tè§£ætokenè·å–å…¶ä¸­çš„userid\nâ€‹\tä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯\nâ€‹\tå­˜å…¥SecurityContextHolder\né…ç½®è¿‡æ»¤å™¨ @Component public class JwtAuthenticationTokenFilter extends OncePerRequestFilter { @Autowired private RedisCache redisCache; @Override protected void doFilterInternal(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, FilterChain filterChain) throws ServletException, IOException { //è·å–è¯·æ±‚å¤´ä¸­çš„token String token = httpServletRequest.getHeader(\"token\"); if (!StringUtils.hasText(token)) { filterChain.doFilter(httpServletRequest, httpServletResponse); return; } //è§£æè·å–userid Claims claims = null; try { claims = JwtUtil.parseJWT(token); } catch (Exception e) { e.printStackTrace(); //tokenè¶…æ—¶ï¼Œtokenéæ³• //å“åº”å‘Šè¯‰å‰ç«¯éœ€è¦é‡æ–°ç™»é™† ResponseResult responseResult = ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN); WebUtils.renderString(httpServletResponse, JSON.toJSONString(responseResult)); return; } String userId = claims.getSubject(); //ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯ LoginUser loginUser = redisCache.getCacheObject(\"bloglogin:\" + userId); if (Objects.isNull(loginUser)) { //å“åº”å‘Šè¯‰å‰ç«¯éœ€è¦é‡æ–°ç™»é™† ResponseResult responseResult = ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN); WebUtils.renderString(httpServletResponse, JSON.toJSONString(responseResult)); return; } //å­˜å…¥SecurityContextHolder UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(loginUser, null, null); SecurityContextHolder.getContext().setAuthentication(authenticationToken); filterChain.doFilter(httpServletRequest,httpServletResponse); } } securityé…ç½® â€‹\tç”±äºé‡å†™äº†configureæ–¹æ³•ï¼ŒUsernamepasswordAuthenticationFilterå¹¶æ²¡æœ‰åŠ å…¥åˆ°è¿‡æ»¤å™¨é“¾ä¸­ï¼Œè¿™é‡ŒaddFilterBeforeæ„æ€æ˜¯æ›¿æ¢UsernamepasswordAuthenticationFilteråŸæ¥çš„ä½ç½®\n@Autowired private JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter; @Override protected void configure(HttpSecurity http) throws Exception { //æŠŠjwtAuthenticationTokenFilteræ·»åŠ åˆ°SpringSecurityçš„è¿‡æ»¤å™¨é“¾ä¸­ http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class); } è®¤è¯å¤±è´¥å¤„ç† â€‹\tç›®å‰æˆ‘ä»¬çš„é¡¹ç›®åœ¨è®¤è¯å‡ºé”™æˆ–è€…æƒé™ä¸è¶³çš„æ—¶å€™å“åº”å›æ¥çš„Jsonæ˜¯Securityçš„å¼‚å¸¸å¤„ç†ç»“æœã€‚ä½†æ˜¯è¿™ä¸ªå“åº”çš„æ ¼å¼è‚¯å®šæ˜¯ä¸ç¬¦åˆæˆ‘ä»¬é¡¹ç›®çš„æ¥å£è§„èŒƒçš„ã€‚æ‰€ä»¥éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ã€‚\nâ€‹\tAuthenticationEntryPoint è®¤è¯å¤±è´¥å¤„ç†å™¨\nâ€‹\tAccessDeniedHandler æˆæƒå¤±è´¥å¤„ç†å™¨\nAccessDeniedHandlerImplå®ç°AccessDeniedHandleræ¥å£\n@Component public class AccessDeniedHandlerImpl implements AccessDeniedHandler { @Override public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException e) throws IOException, ServletException { e.printStackTrace(); ResponseResult responseResult = ResponseResult.errorResult(AppHttpCodeEnum.NO_OPERATOR_AUTH); //å“åº”ç»™å‰ç«¯ WebUtils.renderString(response, JSON.toJSONString(responseResult)); } } AuthenticationEntryPointImplå®ç°AuthenticationEntryPointæ¥å£\n@Component public class AuthenticationEntryPointImpl implements AuthenticationEntryPoint { @Override public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException e) throws IOException, ServletException { e.printStackTrace(); ResponseResult responseResult = null; //æ ¹æ®é”™è¯¯ç±»å‹è¿”å›æ•°æ® if (e instanceof BadCredentialsException) { responseResult = ResponseResult.errorResult(AppHttpCodeEnum.LOGIN_ERROR.getCode(),e.getMessage()); } else if (e instanceof InsufficientAuthenticationException) { responseResult = ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN); } else { responseResult = ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR.getCode(),\"è®¤è¯æˆ–æˆæƒå¤±è´¥\"); } //å“åº”ç»™å‰ç«¯ WebUtils.renderString(response, JSON.toJSONString(responseResult)); } } è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸ è‡ªå®šä¹‰ä¸€ä¸ªå¼‚å¸¸ç±»SystemException public class SystemException extends RuntimeException{ private int code; private String msg; public int getCode() { return code; } public String getMsg() { return msg; } public SystemException(AppHttpCodeEnum httpCodeEnum) { super(httpCodeEnum.getMsg()); this.code = httpCodeEnum.getCode(); this.msg = httpCodeEnum.getMsg(); } } å†™ä¸€ä¸ªhandlerå¤„ç†æŠ›å‡ºçš„å¼‚å¸¸ @RestControllerAdvice @Slf4j public class GlobalExceptionHandler { @ExceptionHandler(SystemException.class) public ResponseResult systemExceptionHandler(SystemException e) { //æ‰“å°å¼‚å¸¸ä¿¡æ¯ log.error(\"å‡ºç°äº†å¼‚å¸¸ï¼{}\",e); //ä»å¼‚å¸¸å¯¹è±¡ä¸­è·å–æç¤ºä¿¡æ¯å°è£…è¿”å› return ResponseResult.errorResult(e.getCode(), e.getMsg()); } /** *å®šä¹‰ä¸€ä¸ªhandlerå¤„ç†å…¶ä»–å¼‚å¸¸ */ @ExceptionHandler(Exception.class) public ResponseResult ExceptionHandler(Exception e) { //æ‰“å°å¼‚å¸¸ä¿¡æ¯ log.error(\"å‡ºç°äº†å¼‚å¸¸ï¼{}\",e); //ä»å¼‚å¸¸å¯¹è±¡ä¸­è·å–æç¤ºä¿¡æ¯å°è£…è¿”å› return ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR); } } @Slf4jï¼šæ‰“å°æ—¥å¿—ä¿¡æ¯çš„æ³¨è§£ï¼Œæ³¨è§£åå¯ä»¥é€šè¿‡log.erroræ‰“å°é”™è¯¯\nå…³é—­8080ç«¯å£ netstat -o -n -a | findstr :8080 taskkill /F /PID 3116\nå¼‚å¸¸å¤„ç†å™¨ è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸ ç”¨æ¥æ•è·æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå…¶ä¸­ä¸šåŠ¡å¼‚å¸¸å¤„ç†å™¨éœ€è¦è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸\n/* å…¨å±€å¼‚å¸¸å¤„ç† */ @ControllerAdvice(annotations = {RestController.class, Controller.class}) @ResponseBody @Slf4j public class GlobalExceptionHandler { /** * å¼‚å¸¸å¤„ç†æ–¹æ³• * * @return */ @ExceptionHandler(SQLIntegrityConstraintViolationException.class) public R\u003cString\u003e exceptionHandler(SQLIntegrityConstraintViolationException ex) { log.error(ex.getMessage()); if (ex.getMessage().contains(\"Duplicate entry\")) { String[] split = ex.getMessage().split(\" \"); String msg = split[2] + \"å·²å­˜åœ¨\"; return R.error(msg); } return R.error(\"æœªçŸ¥é”™è¯¯\"); } /** * ä¸šåŠ¡å¼‚å¸¸å¤„ç†æ–¹æ³• * * @return */ @ExceptionHandler(CustomExpection.class) public R\u003cString\u003e exceptionHandler(CustomExpection ex) { log.error(ex.getMessage()); return R.error(ex.getMessage()); } } public class CustomExpection extends RuntimeException { public CustomExpection(String message) { super(message); } } ä½¿ç”¨æ—¶éœ€è¦æŠ›å‡ºå¼‚å¸¸\nthrow new CustomExpection(\"å½“å‰åˆ†ç±»ä¸‹å…³è”äº†å¥—é¤ï¼Œä¸èƒ½åˆ é™¤\"); ä½¿ç”¨è¿‡æ»¤å™¨å®Œæˆç™»å½•æ ¡éªŒ @Slf4j @WebFilter(filterName = \"loginCheckFilter\",urlPatterns =\"/*\") public class LoginCheckFilter implements Filter { //è·¯å¾„åŒ¹é…å™¨ï¼Œæ”¯æŒé€šé…ç¬¦ public static final AntPathMatcher PATH_MATCHER = new AntPathMatcher(); @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException { HttpServletRequest request = (HttpServletRequest) servletRequest; HttpServletResponse response = (HttpServletResponse) servletResponse; //1ã€è·å–æœ¬æ¬¡è¯·æ±‚çš„URl String requestURl = request.getRequestURI(); log.info(\"æ‹¦æˆªåˆ°è¯·æ±‚ï¼š{}\", request.getRequestURI()); String[] urls = new String[]{ \"/employee/login\", \"/emplyee/logout\", \"/backend/**\", \"/front/**\" }; //2ã€åˆ¤æ–­æœ¬æ¬¡è¯·æ±‚æ˜¯å¦éœ€è¦å¤„ç† boolean check = check(urls, requestURl); //3ã€å¦‚æœä¸éœ€è¦å¤„ç†ç›´æ¥æ”¾è¡Œ if (check) { log.info(\"æœ¬æ¬¡è¯·æ±‚{}ä¸éœ€è¦å¤„ç†\", requestURl); filterChain.doFilter(request, response); return; } //4ã€åˆ¤æ–­ç™»å½•çŠ¶æ€ï¼Œå¦‚æœå·²ç™»å½•ï¼Œç›´æ¥æ”¾è¡Œ if (request.getSession().getAttribute(\"employee\") != null) { Long empId=(Long) request.getSession().getAttribute(\"employee\"); BaseContext.setCurrentId(empId); filterChain.doFilter(request, response); return; } //5ã€å¦‚æœæœªç™»å½•åˆ™è¿”å›æœªç™»å½•ç»“æœï¼Œé€šè¿‡è¾“å‡ºæµæ–¹å¼å‘å®¢æˆ·ç«¯é¡µé¢å“åº”æ•°æ® response.getWriter().write(JSON.toJSONString(R.error(\"NOTLOGIN\"))); return; } public boolean check(String[] urls, String requestURl) { for (String url : urls) { boolean match = PATH_MATCHER.match(url, requestURl); if (match) { return true; } } return false; } } å…¶ä»– æ¶ˆæ¯è½¬æ¢å™¨ å‰ç«¯jsæ–‡ä»¶å¯¹äºLongå‹æ•°æ®ä¼šäº§ç”Ÿç²¾åº¦ä¸¢å¤±ã€‚è§£å†³æ–¹æ³•ä½¿ç”¨å¯¹è±¡æ˜ å°„å™¨\nimport com.fasterxml.jackson.databind.DeserializationFeature; import com.fasterxml.jackson.databind.ObjectMapper; import com.fasterxml.jackson.databind.module.SimpleModule; import com.fasterxml.jackson.databind.ser.std.ToStringSerializer; import com.fasterxml.jackson.datatype.jsr310.deser.LocalDateDeserializer; import com.fasterxml.jackson.datatype.jsr310.deser.LocalDateTimeDeserializer; import com.fasterxml.jackson.datatype.jsr310.deser.LocalTimeDeserializer; import com.fasterxml.jackson.datatype.jsr310.ser.LocalDateSerializer; import com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer; import com.fasterxml.jackson.datatype.jsr310.ser.LocalTimeSerializer; import java.math.BigInteger; import java.time.LocalDate; import java.time.LocalDateTime; import java.time.LocalTime; import java.time.format.DateTimeFormatter; import static com.fasterxml.jackson.databind.DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES; /** * å¯¹è±¡æ˜ å°„å™¨:åŸºäºjacksonå°†Javaå¯¹è±¡è½¬ä¸ºjsonï¼Œæˆ–è€…å°†jsonè½¬ä¸ºJavaå¯¹è±¡ * å°†JSONè§£æä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹ç§°ä¸º [ä»JSONååºåˆ—åŒ–Javaå¯¹è±¡] * ä»Javaå¯¹è±¡ç”ŸæˆJSONçš„è¿‡ç¨‹ç§°ä¸º [åºåˆ—åŒ–Javaå¯¹è±¡åˆ°JSON] */ public class JacksonObjectMapper extends ObjectMapper { public static final String DEFAULT_DATE_FORMAT = \"yyyy-MM-dd\"; public static final String DEFAULT_DATE_TIME_FORMAT = \"yyyy-MM-dd HH:mm:ss\"; public static final String DEFAULT_TIME_FORMAT = \"HH:mm:ss\"; public JacksonObjectMapper() { super(); //æ”¶åˆ°æœªçŸ¥å±æ€§æ—¶ä¸æŠ¥å¼‚å¸¸ this.configure(FAIL_ON_UNKNOWN_PROPERTIES, false); //ååºåˆ—åŒ–æ—¶ï¼Œå±æ€§ä¸å­˜åœ¨çš„å…¼å®¹å¤„ç† this.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES); SimpleModule simpleModule = new SimpleModule() .addDeserializer(LocalDateTime.class, new LocalDateTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT))) .addDeserializer(LocalDate.class, new LocalDateDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT))) .addDeserializer(LocalTime.class, new LocalTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT))) .addSerializer(BigInteger.class, ToStringSerializer.instance) .addSerializer(Long.class, ToStringSerializer.instance) .addSerializer(LocalDateTime.class, new LocalDateTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT))) .addSerializer(LocalDate.class, new LocalDateSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT))) .addSerializer(LocalTime.class, new LocalTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT))); //æ³¨å†ŒåŠŸèƒ½æ¨¡å— ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨ this.registerModule(simpleModule); } } å¹¶åœ¨WebConfigä¸­é…ç½®\n@Configuration public class WebConfig extends WebMvcConfigurationSupport { /** *è®¾ç½®é™æ€èµ„æºæ˜ å°„ */ @Override protected void addResourceHandlers(ResourceHandlerRegistry registry) { registry.addResourceHandler(\"/backend/**\").addResourceLocations(\"classpath:/backend/\"); registry.addResourceHandler(\"/front/**\").addResourceLocations(\"/classpath:/front\"); } @Override protected void extendMessageConverters(List\u003cHttpMessageConverter\u003c?\u003e\u003e converters) { //åˆ›å»ºæ¶ˆæ¯è½¬åŒ–å™¨å¯¹è±¡ MappingJackson2HttpMessageConverter messageConverter = new MappingJackson2HttpMessageConverter(); //è®¾ç½®å¯¹è±¡è½¬æ¢å™¨ï¼Œåº•å±‚ä½¿ç”¨Jacksonå°†å¯¹è±¡è½¬æ¢ä¸ºjson messageConverter.setObjectMapper(new JacksonObjectMapper()); //å°†ä¸Šé¢çš„æ¶ˆæ¯è½¬æ¢å™¨å¯¹è±¡è¿½åŠ åˆ°mvcæ¡†æ¶çš„è½¬æ¢å™¨é›†åˆä¸­ converters.add(0, messageConverter); } } ThreadLocal ThreadLoacalå¹¶ä¸æ˜¯ä¸€ä¸ªThreadï¼Œè€Œæ˜¯Threadçš„å±€éƒ¨å˜é‡ã€‚å½“ä½¿ç”¨ThreadLocalç»´æŠ¤å˜é‡æ—¶ï¼ŒThreadLocalä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹çš„æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹æ‰€å¯¹åº”çš„å‰¯æœ¬ã€‚ThreadLocalä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›å•ç‹¬ä¸€ä»½å­˜å‚¨ç©ºé—´ï¼Œå…·æœ‰çº¿ç¨‹éš”ç¦»çš„æ•ˆæœï¼Œåªæœ‰åœ¨çº¿ç¨‹å†…æ‰èƒ½è·å–ç›¸åº”çš„å€¼ï¼Œçº¿ç¨‹å¤–åˆ™ä¸èƒ½è®¿é—®\nThreadLocalå¸¸ç”¨æ–¹æ³•\npublic void set(T value) //è®¾ç½®å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼ public T get() //è¿”å›å½“å‰çº¿ç¨‹æ‰€å¯¹åº”çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼ ä¾‹ï¼š\npublic class BaseContext { private static ThreadLocal\u003cLong\u003e threadLocal = new ThreadLocal\u003c\u003e(); public static void setCurrentId(Long id) { threadLocal.set(id); } public static Long getCurrentId() { return threadLocal.get(); } } é™æ€èµ„æºæ˜ å°„ ç”±äºåªèƒ½è®¿é—®staticæ–‡ä»¶ä¸‹çš„é™æ€èµ„æºï¼Œå½“éœ€è¦è®¿é—®å…¶ä»–æ–‡ä»¶å¤¹ä¸‹çš„é™æ€èµ„æºéœ€è¦åœ¨WebConfigé‡Œè®¾ç½®é™æ€èµ„æºæ˜ å°„\n@Configuration public class WebConfig extends WebMvcConfigurationSupport { /** *è®¾ç½®é™æ€èµ„æºæ˜ å°„ */ @Override protected void addResourceHandlers(ResourceHandlerRegistry registry) { registry.addResourceHandler(\"/backend/**\").addResourceLocations(\"classpath:/backend/\"); registry.addResourceHandler(\"/front/**\").addResourceLocations(\"/classpath:/front\"); } } Spring Cache @EnableCaching ï¼šå¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½\nåœ¨controlleræ–¹æ³•ä¸ŠåŠ å…¥ä»¥ä¸‹æ³¨è§£ï¼š\n@Cacheableï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰springå…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®åˆ™ç›´æ¥è¿”å›æ•°æ®ï¼›è‹¥æ²¡æœ‰æ•°æ®ï¼Œè°ƒç”¨æ–¹æ³•å¹¶å°†è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­(value=\"?\",key=\"#result.?\",unless=â€œresult==nullâ€)ï¼Œunlessæ»¡è¶³æ¡ä»¶ä¸ç¼“å­˜\n@CachePutï¼šå°†æ–¹æ³•çš„è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­(value=\"?\",key=\"#result.?\"),valueæ˜¯æŒ‡ç¼“å­˜çš„åç§°ï¼Œkeyæ˜¯ç¼“å­˜çš„é”®\n@CacheEvictï¼šå°†ä¸€æ¡æˆ–å¤šæ¡æ•°æ®ä»ç¼“å­˜ä¸­åˆ é™¤(value=\"?\",key=\"#root.args[0]\" or â€œ#idâ€)ï¼ŒallEntries = trueåˆ é™¤è¿™ä¸ªåˆ†ç±»ä¸‹æ‰€æœ‰çš„ç¼“å­˜æ•°æ®\nåœ¨å¯åŠ¨ç±»ä¸Šä½¿ç”¨@EnableCachingå¼€å¯ç¼“å­˜æ”¯æŒ\nä½¿ç”¨redisä½œä¸ºç¼“å­˜æŠ€æœ¯ï¼Œåªéœ€è¦å¯¼å…¥Spring data Redis çš„mavenåæ ‡:\norg.springframework.boot spring-boot-starter-data-redis org.springframework.boot spring-boot-starter-cache é…ç½®redis=ã€‹application.yml\nspring: cache: redis: time-to-live:1800000#è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸms @Autowired private CacheManager cacheManaget swagger 1ã€å¯¼å…¥ä¾èµ–\ncom.github.xiaoymin knife4j-spring-boot-starter 3.0.2 2ã€å¯¼å…¥knife4jç›¸å…³é…ç½®ï¼ˆWebMvcConfigï¼‰\n@EnableSwagger2\n@EnableKnife4j\n@Bean public Docket createRestApi() { //æ–‡æ¡£ç±»å‹ return new Docket(DocumentationType.SWAGGER_2) .apiInfo(apiInfo()) .select() .apis(RequestHandlerSelectors.basePackage(\"com.itheima.reggie.controller\")) .paths(PathSelectors.any()) .build(); } private ApiInfo apiInfo() { return new ApiInfoBuilder() .title(\"ç‘å‰å¤–å–\") .version(\"1.0\") .description(\"ç‘å‰å¤–å–æ¥å£æ–‡æ¡£\") .build(); } 3ã€è®¾ç½®é™æ€èµ„æºæ˜ å°„\nregistry.addResourceHandler(\"doc.html\").addResourceLocations(\"classpath:/META-INF/resources/\"); registry.addResourceHandler(\"/webjars/**\").addResourceLocations(\"classpath:/META-INF/resources/webjars/\"); 4ã€è¿‡æ»¤å™¨ä¸­è®¾ç½®ä¸éœ€è¦å¤„ç†çš„è¯·æ±‚è·¯å¾„\nString[] urls = new String[]{ \"/employee/login\", \"/employee/logout\", \"/backend/**\", \"/front/**\", \"/common/**\", \"/user/sendMsg\", \"/user/login\", \"/doc.html\", \"/webjars/**\", \"/swagger-resources\", \"/v2/api-docs\" }; swaggerApi ",
  "wordCount" : "1293",
  "inLanguage": "en",
  "datePublished": "2022-12-27T17:16:20+08:00",
  "dateModified": "2022-12-27T17:16:20+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "answerboom.github.io/articles/2022/12/27/blognote/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "ğŸ» liyBlog",
    "logo": {
      "@type": "ImageObject",
      "url": "answerboom.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="answerboom.github.io" accesskey="h" title="ğŸ» liyBlog (Alt + H)">ğŸ» liyBlog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="answerboom.github.io/answerboom.github.io/" title="ä¸»é¡µ">
                    <span>ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="answerboom.github.io/answerboom.github.io/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="answerboom.github.io/answerboom.github.io/categories/" title="åˆ†ç±»">
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="answerboom.github.io/answerboom.github.io/tags/" title="æ ‡ç­¾">
                    <span>æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="answerboom.github.io/answerboom.github.io/search/" title="æŸ¥æ‰¾ (Alt &#43; /)" accesskey=/>
                    <span>æŸ¥æ‰¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="answerboom.github.io">Home</a></div>
    <h1 class="post-title">
      Blogç¬”è®°
    </h1>
    <div class="post-meta"><span title='2022-12-27 17:16:20 +0800 CST'>December 27, 2022</span>&nbsp;Â·&nbsp;7 min

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#blog%e9%a1%b9%e7%9b%ae%e7%ac%94%e8%ae%b0" aria-label="blogé¡¹ç›®ç¬”è®°">blogé¡¹ç›®ç¬”è®°</a><ul>
                        
                <li>
                    <a href="#mybatis-plus" aria-label="mybatis plus">mybatis plus</a><ul>
                        <ul>
                        
                <li>
                    <a href="#1-%e7%b1%bb%e6%b3%a8%e8%a7%a3" aria-label="1. ç±»æ³¨è§£">1. ç±»æ³¨è§£</a></li>
                <li>
                    <a href="#2-mybatis-plus%e4%b8%adwapper%e6%96%b9%e6%b3%95" aria-label="2. mybatis plusä¸­wapperæ–¹æ³•">2. mybatis plusä¸­wapperæ–¹æ³•</a></li>
                <li>
                    <a href="#3-%e4%bd%bf%e7%94%a8page%e5%88%86%e9%a1%b5%e9%9c%80%e8%a6%81%e9%85%8d%e7%bd%ae%e5%88%86%e9%a1%b5%e6%8f%92%e4%bb%b6%e5%9c%a8config%e5%8c%85%e4%b8%8b%e5%8a%a0%e5%85%a5%e4%bb%a5%e4%b8%8b%e7%b1%bb" aria-label="3. ä½¿ç”¨pageåˆ†é¡µéœ€è¦é…ç½®åˆ†é¡µæ’ä»¶ï¼Œåœ¨configåŒ…ä¸‹åŠ å…¥ä»¥ä¸‹ç±»">3. ä½¿ç”¨pageåˆ†é¡µéœ€è¦é…ç½®åˆ†é¡µæ’ä»¶ï¼Œåœ¨configåŒ…ä¸‹åŠ å…¥ä»¥ä¸‹ç±»</a></li>
                <li>
                    <a href="#4%e5%85%ac%e5%85%b1%e5%ad%97%e6%ae%b5%e5%a1%ab%e5%85%85" aria-label="4ã€å…¬å…±å­—æ®µå¡«å……">4ã€å…¬å…±å­—æ®µå¡«å……</a></li>
                <li>
                    <a href="#5transactional" aria-label="5ã€@Transactional">5ã€@Transactional</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#strem%e6%b5%81" aria-label="Stremæµ">Stremæµ</a><ul>
                        <ul>
                        
                <li>
                    <a href="#1mapfilter" aria-label="1.mapã€filter">1.mapã€filter</a></li>
                <li>
                    <a href="#2%e6%bc%94%e5%8f%98%e8%bf%87%e7%a8%8b" aria-label="2.æ¼”å˜è¿‡ç¨‹">2.æ¼”å˜è¿‡ç¨‹</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#spring-security" aria-label="Spring Security">Spring Security</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e7%99%bb%e5%bd%95" aria-label="ç™»å½•">ç™»å½•</a></li>
                <li>
                    <a href="#%e7%99%bb%e9%99%86%e6%a0%a1%e9%aa%8c%e8%bf%87%e6%bb%a4%e5%99%a8" aria-label="ç™»é™†æ ¡éªŒè¿‡æ»¤å™¨">ç™»é™†æ ¡éªŒè¿‡æ»¤å™¨</a></li>
                <li>
                    <a href="#%e8%ae%a4%e8%af%81%e5%a4%b1%e8%b4%a5%e5%a4%84%e7%90%86" aria-label="è®¤è¯å¤±è´¥å¤„ç†">è®¤è¯å¤±è´¥å¤„ç†</a></li>
                <li>
                    <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%85%a8%e5%b1%80%e5%bc%82%e5%b8%b8" aria-label="è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸">è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e5%85%b3%e9%97%ad8080%e7%ab%af%e5%8f%a3" aria-label="å…³é—­8080ç«¯å£">å…³é—­8080ç«¯å£</a></li>
                <li>
                    <a href="#%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86%e5%99%a8" aria-label="å¼‚å¸¸å¤„ç†å™¨">å¼‚å¸¸å¤„ç†å™¨</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%85%a8%e5%b1%80%e5%bc%82%e5%b8%b8-1" aria-label="è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸">è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e8%bf%87%e6%bb%a4%e5%99%a8%e5%ae%8c%e6%88%90%e7%99%bb%e5%bd%95%e6%a0%a1%e9%aa%8c" aria-label="ä½¿ç”¨è¿‡æ»¤å™¨å®Œæˆç™»å½•æ ¡éªŒ">ä½¿ç”¨è¿‡æ»¤å™¨å®Œæˆç™»å½•æ ¡éªŒ</a></li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96" aria-label="å…¶ä»–">å…¶ä»–</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e6%b6%88%e6%81%af%e8%bd%ac%e6%8d%a2%e5%99%a8" aria-label="æ¶ˆæ¯è½¬æ¢å™¨">æ¶ˆæ¯è½¬æ¢å™¨</a></li>
                <li>
                    <a href="#threadlocal" aria-label="ThreadLocal">ThreadLocal</a></li>
                <li>
                    <a href="#%e9%9d%99%e6%80%81%e8%b5%84%e6%ba%90%e6%98%a0%e5%b0%84" aria-label="é™æ€èµ„æºæ˜ å°„">é™æ€èµ„æºæ˜ å°„</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#spring-cache" aria-label="Spring Cache">Spring Cache</a></li>
                <li>
                    <a href="#swagger" aria-label="swagger">swagger</a><ul>
                        <ul>
                        
                <li>
                    <a href="#swaggerapi" aria-label="swaggerApi">swaggerApi</a>
                </li>
            </ul>
            </li>
            </ul>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="blogé¡¹ç›®ç¬”è®°">blogé¡¹ç›®ç¬”è®°<a hidden class="anchor" aria-hidden="true" href="#blogé¡¹ç›®ç¬”è®°">#</a></h1>
<h2 id="mybatis-plus">mybatis plus<a hidden class="anchor" aria-hidden="true" href="#mybatis-plus">#</a></h2>
<h4 id="1-ç±»æ³¨è§£">1. ç±»æ³¨è§£<a hidden class="anchor" aria-hidden="true" href="#1-ç±»æ³¨è§£">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@NoArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@AllArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@TableName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;sg_article&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Accessors</span><span style="color:#f92672">(</span>chain <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Article</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><code>@Data</code>ï¼šæ³¨åœ¨ç±»ä¸Šï¼Œæä¾›ç±»çš„getã€setã€equalsã€hashCodeã€toStringæ–¹æ³•</p>
<p><code>@NoArgsConstructor</code>ï¼šæä¾›ç±»çš„æ— å‚æ„é€ </p>
<p><code>@AllArgsConstructor</code>ï¼šæä¾›ç±»çš„å…¨å‚æ„é€ </p>
<p><code>@TableName(&quot;sg_article&quot;)</code>ï¼šå°†è¡¨ä¸æ•°æ®åº“é‡Œçš„è¡¨å¯¹åº”èµ·æ¥</p>
<p><code>@Accessors(chain = true)</code>ï¼šå°†getã€setæ–¹æ³•çš„è¿”å›ç±»å‹è®¾ç½®ä¸ºå®ä½“ç±»å¯¹è±¡ï¼Œä»£æ›¿äº†é»˜è®¤çš„è¿”å›void</p>
<p>å®ä½“ç±»ä¸­åŠ å…¥æ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„åˆ—åéœ€è¦åŠ å…¥TableFieldæ³¨è§£æ ‡è¯†</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@TableField</span><span style="color:#f92672">(</span>exist <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String categoryName<span style="color:#f92672">;</span>
</span></span></code></pre></div><h4 id="2-mybatis-plusä¸­wapperæ–¹æ³•">2. mybatis plusä¸­wapperæ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#2-mybatis-plusä¸­wapperæ–¹æ³•">#</a></h4>
<p><code>queryWapper.eqï¼ˆå­—æ®µåï¼Œvalï¼‰</code></p>
<p>å­—æ®µåå¯ä»¥ç”¨å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ç”¨æ–¹æ³•ï¼šArticle::getStatus</p>
<p>æ¨èç”¨æ–¹æ³•é˜²æ­¢åˆ—åå†™é”™</p>
<p><code>lambdaQueryWrapper.eq(Objects.nonNull(categoryId) &amp;&amp; categoryId &gt; 0, Article::getCategoryId, categoryId);</code></p>
<p>eqæ–¹æ³•ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªbooleanä¸ºtrueæ—¶å¼•å…¥åŠ å…¥åä¸¤ä¸ªå‚æ•°æ¡ä»¶ï¼Œä¸ºfalseæ—¶ä¸åŠ å…¥</p>
<h4 id="3-ä½¿ç”¨pageåˆ†é¡µéœ€è¦é…ç½®åˆ†é¡µæ’ä»¶åœ¨configåŒ…ä¸‹åŠ å…¥ä»¥ä¸‹ç±»">3. ä½¿ç”¨pageåˆ†é¡µéœ€è¦é…ç½®åˆ†é¡µæ’ä»¶ï¼Œåœ¨configåŒ…ä¸‹åŠ å…¥ä»¥ä¸‹ç±»<a hidden class="anchor" aria-hidden="true" href="#3-ä½¿ç”¨pageåˆ†é¡µéœ€è¦é…ç½®åˆ†é¡µæ’ä»¶åœ¨configåŒ…ä¸‹åŠ å…¥ä»¥ä¸‹ç±»">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MbatisPlusConfig</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * 3.4.0ä¹‹åç‰ˆæœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> MybatisPlusInterceptor <span style="color:#a6e22e">mybatisPlusInterceptor</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        MybatisPlusInterceptor mybatisPlusInterceptor <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MybatisPlusInterceptor<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        mybatisPlusInterceptor<span style="color:#f92672">.</span><span style="color:#a6e22e">addInnerInterceptor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> PaginationInnerInterceptor<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> mybatisPlusInterceptor<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="4å…¬å…±å­—æ®µå¡«å……">4ã€å…¬å…±å­—æ®µå¡«å……<a hidden class="anchor" aria-hidden="true" href="#4å…¬å…±å­—æ®µå¡«å……">#</a></h4>
<p>æ’å…¥æ—¶é—´ã€æ›´æ–°æ—¶é—´çš„è‡ªåŠ¨å¡«å……</p>
<p>1ã€åœ¨å®ä½“ç±»çš„å±æ€§ä¸ŠåŠ å…¥@TableFieldæ³¨è§£ï¼ŒæŒ‡å®šè‡ªåŠ¨å¡«å……çš„ç­–ç•¥</p>
<p>2ã€æŒ‰ç…§æ¡†æ¶è¦æ±‚ç¼–å†™å…ƒæ•°æ®å¯¹è±¡å¤„ç†å™¨ï¼Œåœ¨æ­¤ç±»ä¸­ç»Ÿä¸€ä¸ºå…¬å…±å­—æ®µèµ‹å€¼ï¼Œæ­¤ç±»éœ€è¦å®ç°MetaObjectHandleræ¥å£</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@TableField</span><span style="color:#f92672">(</span>fill<span style="color:#f92672">=</span>FieldFill<span style="color:#f92672">.</span><span style="color:#a6e22e">INSERT</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> LocalDateTime createTime<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@TableField</span><span style="color:#f92672">(</span>fill<span style="color:#f92672">=</span>FieldFill<span style="color:#f92672">.</span><span style="color:#a6e22e">INSERT_UPDATE</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> LocalDateTime updateTime<span style="color:#f92672">;</span>
</span></span></code></pre></div><pre tabindex="0"><code class="language-jav" data-lang="jav">@Component
public class MyMetaObjectHandler implements MetaObjectHandler {
    @Override
    public void insertFill(MetaObject metaObject) {
        metaObject.setValue(&#34;createTime&#34;, LocalDateTime.now());
        metaObject.setValue(&#34;updateTime&#34;, LocalDateTime.now());
        metaObject.setValue(&#34;createUser&#34;,new Long(1));
        metaObject.setValue(&#34;updateUser&#34;,new Long(1));
    }

    @Override
    public void updateFill(MetaObject metaObject) {
        metaObject.setValue(&#34;updateTime&#34;, LocalDateTime.now());
        metaObject.setValue(&#34;updateUser&#34;,new Long(1));
    }
}
</code></pre><h4 id="5transactional">5ã€@Transactional<a hidden class="anchor" aria-hidden="true" href="#5transactional">#</a></h4>
<p>â€‹	æ¶‰åŠå¤šå¼ è¡¨æ“ä½œçš„æ–¹æ³•éœ€è¦åŠ å…¥@Transactionalæ³¨è§£ï¼Œå¹¶åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableTransactionManagementæ³¨è§£</p>
<h2 id="stremæµ">Stremæµ<a hidden class="anchor" aria-hidden="true" href="#stremæµ">#</a></h2>
<h4 id="1mapfilter">1.mapã€filter<a hidden class="anchor" aria-hidden="true" href="#1mapfilter">#</a></h4>
<p>Streamæµä¸­ï¼Œmapå¯ä»¥å°†ä¸€ä¸ªæµçš„å…ƒç´ æŒ‰ç…§ä¸€å®šçš„æ˜ å°„è§„åˆ™æ˜ å°„åˆ°å¦ä¸€ä¸ªæµä¸­ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#f92672">&lt;</span>O<span style="color:#f92672">,</span>T<span style="color:#f92672">&gt;</span> List<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">copyBeanList</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>O<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">,</span>Class<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> clazz<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> list<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">.</span><span style="color:#a6e22e">map</span><span style="color:#f92672">(</span>o <span style="color:#f92672">-&gt;</span> copyBean<span style="color:#f92672">(</span>o<span style="color:#f92672">,</span>clazz<span style="color:#f92672">)).</span><span style="color:#a6e22e">collect</span><span style="color:#f92672">(</span>Collectors<span style="color:#f92672">.</span><span style="color:#a6e22e">toList</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><p>lambdaæ˜¯å¯¹åŒ¿åå†…éƒ¨ç±»çš„ä¸€ç§ç®€å†™</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>categories <span style="color:#f92672">=</span> categories<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">().</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Predicate<span style="color:#f92672">&lt;</span>Category<span style="color:#f92672">&gt;()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">(</span>Category category<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> SystemConstants<span style="color:#f92672">.</span><span style="color:#a6e22e">STATUS_NORMAL</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>category<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatus</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}).</span><span style="color:#a6e22e">collect</span><span style="color:#f92672">(</span>Collectors<span style="color:#f92672">.</span><span style="color:#a6e22e">toList</span><span style="color:#f92672">());</span>
</span></span></code></pre></div><p>ç®€å†™å</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>List<span style="color:#f92672">&lt;</span>category<span style="color:#f92672">&gt;</span> categories <span style="color:#f92672">=</span> categories<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">().</span><span style="color:#a6e22e">filter</span><span style="color:#f92672">(</span>category <span style="color:#f92672">-&gt;</span> 		     SystemConstants<span style="color:#f92672">.</span><span style="color:#a6e22e">STATUS_NORMAL</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>category<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatus</span><span style="color:#f92672">())).</span><span style="color:#a6e22e">collect</span><span style="color:#f92672">(</span>Collectors<span style="color:#f92672">.</span><span style="color:#a6e22e">toList</span><span style="color:#f92672">());</span>
</span></span></code></pre></div><p>filterè¿‡æ»¤æ‰ä¸æ»¡è¶³è¡¨è¾¾å¼çš„å…ƒç´ </p>
<p>collectæ“ä½œå¯ä»¥æ¥å—å„ç§æ–¹æ³•ä½œä¸ºå‚æ•°ï¼Œå°†æµä¸­çš„å…ƒç´ æ±‡é›†ã€‚</p>
<h4 id="2æ¼”å˜è¿‡ç¨‹">2.æ¼”å˜è¿‡ç¨‹<a hidden class="anchor" aria-hidden="true" href="#2æ¼”å˜è¿‡ç¨‹">#</a></h4>
<p>å°†åˆ†ç±»è¡¨nameæ ¹æ®categoryIdèµ‹å€¼ç»™Articleçš„categoryName</p>
<p>ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»</p>
<pre tabindex="0"><code class="language-jav" data-lang="jav">        articles.stream().map(new Function&lt;Article, Article&gt;() {
            @Override
            public Article apply(Article article) {
                //è·å–åˆ†ç±»idï¼ŒæŸ¥è¯¢åˆ†ç±»ä¿¡æ¯ï¼Œè·å–åˆ†ç±»åç§°
                Category category = categoryService.getById(article.getCategoryId());
                String name = category.getName();
                article.setCategoryName(name);
                return article;
            }
        })
</code></pre><p>ä½¿ç”¨lambdaè¡¨è¾¾å¼</p>
<ol>
<li>
<p>åªå…³æ³¨å‚æ•°åˆ—è¡¨å’Œæ–¹æ³•ä½“</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">(</span>Article article<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//è·å–åˆ†ç±»idï¼ŒæŸ¥è¯¢åˆ†ç±»ä¿¡æ¯ï¼Œè·å–åˆ†ç±»åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                Category category <span style="color:#f92672">=</span> categoryService<span style="color:#f92672">.</span><span style="color:#a6e22e">getById</span><span style="color:#f92672">(</span>article<span style="color:#f92672">.</span><span style="color:#a6e22e">getCategoryId</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>                String name <span style="color:#f92672">=</span> category<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                article<span style="color:#f92672">.</span><span style="color:#a6e22e">setCategoryName</span><span style="color:#f92672">(</span>name<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> article<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>å‚æ•°åˆ—è¡¨å’Œæ–¹æ³•ä½“ç”¨ä¸€ä¸ªç®­å¤´ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°åˆ™å‚æ•°ç±»å‹ã€å°æ‹¬å·å¯ä»¥çœç•¥ï¼Œå¤§æ‹¬å·å’Œreturnå¯ä»¥å»æ‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        articles<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">().</span><span style="color:#a6e22e">map</span><span style="color:#f92672">(</span>article <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>                Category category <span style="color:#f92672">=</span> categoryService<span style="color:#f92672">.</span><span style="color:#a6e22e">getById</span><span style="color:#f92672">(</span>article<span style="color:#f92672">.</span><span style="color:#a6e22e">getCategoryId</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>                String name <span style="color:#f92672">=</span> category<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>                article<span style="color:#f92672">.</span><span style="color:#a6e22e">setCategoryName</span><span style="color:#f92672">(</span>name<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> article<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">)</span>
</span></span></code></pre></div></li>
<li>
<p>ç®€åŒ–å®Œæˆå</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>articles <span style="color:#f92672">=</span> articles<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">map</span><span style="color:#f92672">(</span>article <span style="color:#f92672">-&gt;</span> article<span style="color:#f92672">.</span><span style="color:#a6e22e">setCategoryName</span><span style="color:#f92672">(</span>categoryService<span style="color:#f92672">.</span><span style="color:#a6e22e">getById</span><span style="color:#f92672">(</span>article<span style="color:#f92672">.</span><span style="color:#a6e22e">getCategoryId</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">())).</span><span style="color:#a6e22e">collect</span><span style="color:#f92672">(</span>Collectors<span style="color:#f92672">.</span><span style="color:#a6e22e">toList</span><span style="color:#f92672">());</span>
</span></span></code></pre></div></li>
</ol>
<h2 id="spring-security">Spring Security<a hidden class="anchor" aria-hidden="true" href="#spring-security">#</a></h2>
<ol>
<li>
<p>åŠ å…¥ä¾èµ–</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#f92672">&lt;!--</span>SpringSecurity<span style="color:#960050;background-color:#1e0010">å¯åŠ¨å™¨</span><span style="color:#f92672">--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">springframework</span><span style="color:#f92672">.</span><span style="color:#a6e22e">boot</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>spring<span style="color:#f92672">-</span>boot<span style="color:#f92672">-</span>starter<span style="color:#f92672">-</span>security<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;!--</span>redis<span style="color:#960050;background-color:#1e0010">ä¾èµ–</span><span style="color:#f92672">--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">springframework</span><span style="color:#f92672">.</span><span style="color:#a6e22e">boot</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>spring<span style="color:#f92672">-</span>boot<span style="color:#f92672">-</span>starter<span style="color:#f92672">-</span>data<span style="color:#f92672">-</span>redis<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;!--</span>fastjson<span style="color:#960050;background-color:#1e0010">ä¾èµ–</span><span style="color:#f92672">--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>com<span style="color:#f92672">.</span><span style="color:#a6e22e">alibaba</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>fastjson<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;!--</span>jwt<span style="color:#960050;background-color:#1e0010">ä¾èµ–</span><span style="color:#f92672">--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span>dependency<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>groupId<span style="color:#f92672">&gt;</span>io<span style="color:#f92672">.</span><span style="color:#a6e22e">jsonwebtoken</span><span style="color:#f92672">&lt;/</span>groupId<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;</span>artifactId<span style="color:#f92672">&gt;</span>jjwt<span style="color:#f92672">&lt;/</span>artifactId<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/</span>dependency<span style="color:#f92672">&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>åŠ å…¥å·¥å…·ç±»å’Œé…ç½®</p>
</li>
</ol>
<h4 id="ç™»å½•">ç™»å½•<a hidden class="anchor" aria-hidden="true" href="#ç™»å½•">#</a></h4>
<p><img loading="lazy" src="/img/blog%e7%ac%94%e8%ae%b0/securityMethod.png" alt="securityæµç¨‹"  />
</p>
<blockquote>
<p>â€‹	â‘ è‡ªå®šä¹‰ç™»å½•æ¥å£</p>
<p>â€‹				è°ƒç”¨ProviderManagerçš„æ–¹æ³•è¿›è¡Œè®¤è¯ å¦‚æœè®¤è¯é€šè¿‡ç”Ÿæˆjwt</p>
<p>â€‹				æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redisä¸­</p>
<p>â€‹	â‘¡è‡ªå®šä¹‰UserDetailsService</p>
<p>â€‹				åœ¨è¿™ä¸ªå®ç°ç±»ä¸­å»æŸ¥è¯¢æ•°æ®åº“</p>
<p>â€‹	æ³¨æ„é…ç½®passwordEncoderä¸ºBCryptPasswordEncoder</p>
</blockquote>
<ol start="3">
<li>
<p>å°†authenticationManageræ³¨å…¥å®¹å™¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> AuthenticationManager authenticationManager<span style="color:#f92672">;</span>
</span></span></code></pre></div><p>æ­¤æ—¶è¿˜å®¹å™¨ä¸­è¿˜æ²¡æœ‰authenticationManagerï¼Œéœ€è¦åœ¨é…ç½®ç±»ä¸­é…ç½®</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecurityConfig</span> <span style="color:#66d9ef">extends</span> WebSecurityConfigurerAdapter <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*è¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªAuthenticationManagerçš„å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*é€šè¿‡beanæ³¨è§£æ³¨å…¥å®¹å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> AuthenticationManager <span style="color:#a6e22e">authenticationManagerBean</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">authenticationManagerBean</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>è°ƒç”¨authenticationManagerçš„authenticateçš„æ–¹æ³•ï¼Œä½†æ˜¯authenticateä¼šè°ƒç”¨UserDetailsServiceçš„è‡ªå¸¦æ–¹æ³•ï¼ˆéœ€è¦é‡å†™ï¼‰å»è®¿é—®å†…å­˜ï¼Œå®é™…éœ€æ±‚éœ€è¦å»è®¿é—®æ•°æ®åº“</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserDetailsServiceImpl</span> <span style="color:#66d9ef">implements</span> UserDetailsService <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> UserMapper userMapper<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> UserDetails <span style="color:#a6e22e">loadUserByUsername</span><span style="color:#f92672">(</span>String username<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> UsernameNotFoundException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        LambdaQueryWrapper<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> lambdaQueryWrapper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LambdaQueryWrapper<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        lambdaQueryWrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">eq</span><span style="color:#f92672">(</span>User<span style="color:#f92672">::</span>getUserName<span style="color:#f92672">,</span> username<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        User user <span style="color:#f92672">=</span> userMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">selectOne</span><span style="color:#f92672">(</span>lambdaQueryWrapper<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//åˆ¤æ–­æ˜¯å¦æŸ¥åˆ°ç”¨æˆ·ï¼Œå¦‚æœæ²¡æŸ¥åˆ°æŠ›å‡ºå¼‚å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>Objects<span style="color:#f92672">.</span><span style="color:#a6e22e">isNull</span><span style="color:#f92672">(</span>user<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ç”¨æˆ·ä¸å­˜åœ¨&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//è¿”å›ç”¨æˆ·ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">//TODO æŸ¥è¯¢æƒé™ä¿¡æ¯å°è£…
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//LoginUseræ˜¯UserDetailsçš„å®ç°ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> LoginUser<span style="color:#f92672">(</span>user<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>é€šè¿‡serviceæ³¨è§£æ³¨å…¥å®¹å™¨å¯ä»¥å®ç°æ›¿æ¢åŸæ¥çš„æ–¹æ³•å®ç°æ ¡éªŒ</p>
</li>
<li>
<p>è°ƒç”¨å®Œauthenticateä¼šè¿”å›authenticateå¯¹è±¡ï¼Œç»§ç»­å®ç°loginçš„æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BlogLoginServiceImpl</span> <span style="color:#66d9ef">implements</span> BlogLoginService <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> AuthenticationManager authenticationManager<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> RedisCache redisCache<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ResponseResult <span style="color:#a6e22e">login</span><span style="color:#f92672">(</span>User user<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UsernamePasswordAuthenticationToken<span style="color:#f92672">(</span>user<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserName</span><span style="color:#f92672">(),</span> user<span style="color:#f92672">.</span><span style="color:#a6e22e">getPassword</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        Authentication authenticate <span style="color:#f92672">=</span> authenticationManager<span style="color:#f92672">.</span><span style="color:#a6e22e">authenticate</span><span style="color:#f92672">(</span>usernamePasswordAuthenticationToken<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//åˆ¤æ–­æ˜¯å¦è®¤è¯é€šè¿‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>Objects<span style="color:#f92672">.</span><span style="color:#a6e22e">isNull</span><span style="color:#f92672">(</span>authenticate<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//è·å–useridç”Ÿæˆtoken
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">//getPrincipalæ˜¯è·å–authenticateçš„ä¸»ä½“ï¼Œé‡Œé¢å°è£…äº†ä¹‹å‰ä¼ å…¥çš„loginUser
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        LoginUser loginUser <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>LoginUser<span style="color:#f92672">)</span> authenticate<span style="color:#f92672">.</span><span style="color:#a6e22e">getPrincipal</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        String userId <span style="color:#f92672">=</span> loginUser<span style="color:#f92672">.</span><span style="color:#a6e22e">getUser</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//å°†useridåŠ å¯†æˆjwt
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String jwt <span style="color:#f92672">=</span> JwtUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">createJWT</span><span style="color:#f92672">(</span>userId<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redis
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        redisCache<span style="color:#f92672">.</span><span style="color:#a6e22e">setCacheObject</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bolglogin:&#34;</span><span style="color:#f92672">+</span>userId<span style="color:#f92672">,</span>loginUser<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//æŠŠtokenå’Œuserinfoå°è£…è¿”å›
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">//æŠŠUserè½¬æ¢æˆUserInfoVo
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        UserInfoVo userInfoVo <span style="color:#f92672">=</span> BeanCopyUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">copyBean</span><span style="color:#f92672">(</span>loginUser<span style="color:#f92672">.</span><span style="color:#a6e22e">getUser</span><span style="color:#f92672">(),</span> UserInfoVo<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        BlogUserLoginVo vo <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BlogUserLoginVo<span style="color:#f92672">(</span>jwt<span style="color:#f92672">,</span>userInfoVo<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ResponseResult<span style="color:#f92672">.</span><span style="color:#a6e22e">okResult</span><span style="color:#f92672">(</span>vo<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>é…ç½®securityé…ç½®ç±»</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configure</span><span style="color:#f92672">(</span>HttpSecurity http<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        http
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//å…³é—­csrf
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">csrf</span><span style="color:#f92672">().</span><span style="color:#a6e22e">disable</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//ä¸é€šè¿‡Sessionè·å–SecurityContext
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">sessionManagement</span><span style="color:#f92672">().</span><span style="color:#a6e22e">sessionCreationPolicy</span><span style="color:#f92672">(</span>SessionCreationPolicy<span style="color:#f92672">.</span><span style="color:#a6e22e">STATELESS</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">and</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">authorizeRequests</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">antMatchers</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">anonymous</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//jwtè¿‡æ»¤å™¨æµ‹è¯•ç”¨ï¼Œå¦‚æœæµ‹è¯•æ²¡æœ‰é—®é¢˜å§è¿™é‡Œåˆ é™¤äº†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">antMatchers</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/link/getAllLink&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">authenticated</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨ä¸éœ€è¦è®¤è¯å³å¯è®¿é—®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">anyRequest</span><span style="color:#f92672">().</span><span style="color:#a6e22e">permitAll</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        http<span style="color:#f92672">.</span><span style="color:#a6e22e">logout</span><span style="color:#f92672">().</span><span style="color:#a6e22e">disable</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//å…è®¸è·¨åŸŸ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        http<span style="color:#f92672">.</span><span style="color:#a6e22e">cors</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> PasswordEncoder <span style="color:#a6e22e">passwordEncoder</span><span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> BCryptPasswordEncoder<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ol>
<h4 id="ç™»é™†æ ¡éªŒè¿‡æ»¤å™¨">ç™»é™†æ ¡éªŒè¿‡æ»¤å™¨<a hidden class="anchor" aria-hidden="true" href="#ç™»é™†æ ¡éªŒè¿‡æ»¤å™¨">#</a></h4>
<blockquote>
<p>â€‹	â‘ å®šä¹‰Jwtè®¤è¯è¿‡æ»¤å™¨</p>
<p>â€‹				è·å–token</p>
<p>â€‹				è§£ætokenè·å–å…¶ä¸­çš„userid</p>
<p>â€‹				ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯</p>
<p>â€‹				å­˜å…¥SecurityContextHolder</p>
</blockquote>
<ol>
<li>é…ç½®è¿‡æ»¤å™¨</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">JwtAuthenticationTokenFilter</span> <span style="color:#66d9ef">extends</span> OncePerRequestFilter <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> RedisCache redisCache<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doFilterInternal</span><span style="color:#f92672">(</span>HttpServletRequest httpServletRequest<span style="color:#f92672">,</span> HttpServletResponse httpServletResponse<span style="color:#f92672">,</span> FilterChain filterChain<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//è·å–è¯·æ±‚å¤´ä¸­çš„token
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String token <span style="color:#f92672">=</span> httpServletRequest<span style="color:#f92672">.</span><span style="color:#a6e22e">getHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;token&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>StringUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">hasText</span><span style="color:#f92672">(</span>token<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            filterChain<span style="color:#f92672">.</span><span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>httpServletRequest<span style="color:#f92672">,</span> httpServletResponse<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//è§£æè·å–userid
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        Claims claims <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            claims <span style="color:#f92672">=</span> JwtUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">parseJWT</span><span style="color:#f92672">(</span>token<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//tokenè¶…æ—¶ï¼Œtokenéæ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e">//å“åº”å‘Šè¯‰å‰ç«¯éœ€è¦é‡æ–°ç™»é™†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            ResponseResult responseResult <span style="color:#f92672">=</span> ResponseResult<span style="color:#f92672">.</span><span style="color:#a6e22e">errorResult</span><span style="color:#f92672">(</span>AppHttpCodeEnum<span style="color:#f92672">.</span><span style="color:#a6e22e">NEED_LOGIN</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            WebUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">renderString</span><span style="color:#f92672">(</span>httpServletResponse<span style="color:#f92672">,</span> JSON<span style="color:#f92672">.</span><span style="color:#a6e22e">toJSONString</span><span style="color:#f92672">(</span>responseResult<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        String userId <span style="color:#f92672">=</span> claims<span style="color:#f92672">.</span><span style="color:#a6e22e">getSubject</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        LoginUser loginUser <span style="color:#f92672">=</span> redisCache<span style="color:#f92672">.</span><span style="color:#a6e22e">getCacheObject</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bloglogin:&#34;</span> <span style="color:#f92672">+</span> userId<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>Objects<span style="color:#f92672">.</span><span style="color:#a6e22e">isNull</span><span style="color:#f92672">(</span>loginUser<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//å“åº”å‘Šè¯‰å‰ç«¯éœ€è¦é‡æ–°ç™»é™†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            ResponseResult responseResult <span style="color:#f92672">=</span> ResponseResult<span style="color:#f92672">.</span><span style="color:#a6e22e">errorResult</span><span style="color:#f92672">(</span>AppHttpCodeEnum<span style="color:#f92672">.</span><span style="color:#a6e22e">NEED_LOGIN</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            WebUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">renderString</span><span style="color:#f92672">(</span>httpServletResponse<span style="color:#f92672">,</span> JSON<span style="color:#f92672">.</span><span style="color:#a6e22e">toJSONString</span><span style="color:#f92672">(</span>responseResult<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//å­˜å…¥SecurityContextHolder
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        UsernamePasswordAuthenticationToken authenticationToken <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UsernamePasswordAuthenticationToken<span style="color:#f92672">(</span>loginUser<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        SecurityContextHolder<span style="color:#f92672">.</span><span style="color:#a6e22e">getContext</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setAuthentication</span><span style="color:#f92672">(</span>authenticationToken<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        filterChain<span style="color:#f92672">.</span><span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>httpServletRequest<span style="color:#f92672">,</span>httpServletResponse<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ol start="2">
<li>securityé…ç½®</li>
</ol>
<p>â€‹	ç”±äºé‡å†™äº†configureæ–¹æ³•ï¼ŒUsernamepasswordAuthenticationFilterå¹¶æ²¡æœ‰åŠ å…¥åˆ°è¿‡æ»¤å™¨é“¾ä¸­ï¼Œè¿™é‡ŒaddFilterBeforeæ„æ€æ˜¯æ›¿æ¢UsernamepasswordAuthenticationFilteråŸæ¥çš„ä½ç½®</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configure</span><span style="color:#f92672">(</span>HttpSecurity http<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//æŠŠjwtAuthenticationTokenFilteræ·»åŠ åˆ°SpringSecurityçš„è¿‡æ»¤å™¨é“¾ä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        http<span style="color:#f92672">.</span><span style="color:#a6e22e">addFilterBefore</span><span style="color:#f92672">(</span>jwtAuthenticationTokenFilter<span style="color:#f92672">,</span> UsernamePasswordAuthenticationFilter<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="è®¤è¯å¤±è´¥å¤„ç†">è®¤è¯å¤±è´¥å¤„ç†<a hidden class="anchor" aria-hidden="true" href="#è®¤è¯å¤±è´¥å¤„ç†">#</a></h4>
<blockquote>
<p>â€‹	ç›®å‰æˆ‘ä»¬çš„é¡¹ç›®åœ¨è®¤è¯å‡ºé”™æˆ–è€…æƒé™ä¸è¶³çš„æ—¶å€™å“åº”å›æ¥çš„Jsonæ˜¯Securityçš„å¼‚å¸¸å¤„ç†ç»“æœã€‚ä½†æ˜¯è¿™ä¸ªå“åº”çš„æ ¼å¼è‚¯å®šæ˜¯ä¸ç¬¦åˆæˆ‘ä»¬é¡¹ç›®çš„æ¥å£è§„èŒƒçš„ã€‚æ‰€ä»¥éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ã€‚</p>
<p>â€‹	AuthenticationEntryPoint è®¤è¯å¤±è´¥å¤„ç†å™¨</p>
<p>â€‹	AccessDeniedHandler æˆæƒå¤±è´¥å¤„ç†å™¨</p>
</blockquote>
<ol>
<li>
<p>AccessDeniedHandlerImplå®ç°AccessDeniedHandleræ¥å£</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AccessDeniedHandlerImpl</span> <span style="color:#66d9ef">implements</span> AccessDeniedHandler <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">handle</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">,</span> AccessDeniedException e<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> ServletException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        ResponseResult responseResult <span style="color:#f92672">=</span> ResponseResult<span style="color:#f92672">.</span><span style="color:#a6e22e">errorResult</span><span style="color:#f92672">(</span>AppHttpCodeEnum<span style="color:#f92672">.</span><span style="color:#a6e22e">NO_OPERATOR_AUTH</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//å“åº”ç»™å‰ç«¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        WebUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">renderString</span><span style="color:#f92672">(</span>response<span style="color:#f92672">,</span> JSON<span style="color:#f92672">.</span><span style="color:#a6e22e">toJSONString</span><span style="color:#f92672">(</span>responseResult<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>AuthenticationEntryPointImplå®ç°AuthenticationEntryPointæ¥å£</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AuthenticationEntryPointImpl</span> <span style="color:#66d9ef">implements</span> AuthenticationEntryPoint <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">commence</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">,</span> AuthenticationException e<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> ServletException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        ResponseResult responseResult <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//æ ¹æ®é”™è¯¯ç±»å‹è¿”å›æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>e <span style="color:#66d9ef">instanceof</span> BadCredentialsException<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            responseResult <span style="color:#f92672">=</span> ResponseResult<span style="color:#f92672">.</span><span style="color:#a6e22e">errorResult</span><span style="color:#f92672">(</span>AppHttpCodeEnum<span style="color:#f92672">.</span><span style="color:#a6e22e">LOGIN_ERROR</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getCode</span><span style="color:#f92672">(),</span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>e <span style="color:#66d9ef">instanceof</span> InsufficientAuthenticationException<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            responseResult <span style="color:#f92672">=</span> ResponseResult<span style="color:#f92672">.</span><span style="color:#a6e22e">errorResult</span><span style="color:#f92672">(</span>AppHttpCodeEnum<span style="color:#f92672">.</span><span style="color:#a6e22e">NEED_LOGIN</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            responseResult <span style="color:#f92672">=</span> ResponseResult<span style="color:#f92672">.</span><span style="color:#a6e22e">errorResult</span><span style="color:#f92672">(</span>AppHttpCodeEnum<span style="color:#f92672">.</span><span style="color:#a6e22e">SYSTEM_ERROR</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getCode</span><span style="color:#f92672">(),</span><span style="color:#e6db74">&#34;è®¤è¯æˆ–æˆæƒå¤±è´¥&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//å“åº”ç»™å‰ç«¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        WebUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">renderString</span><span style="color:#f92672">(</span>response<span style="color:#f92672">,</span> JSON<span style="color:#f92672">.</span><span style="color:#a6e22e">toJSONString</span><span style="color:#f92672">(</span>responseResult<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
</ol>
<h4 id="è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸">è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸<a hidden class="anchor" aria-hidden="true" href="#è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸">#</a></h4>
<ol>
<li>è‡ªå®šä¹‰ä¸€ä¸ªå¼‚å¸¸ç±»SystemException</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SystemException</span> <span style="color:#66d9ef">extends</span> RuntimeException<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> code<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String msg<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getCode</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> code<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getMsg</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> msg<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">SystemException</span><span style="color:#f92672">(</span>AppHttpCodeEnum httpCodeEnum<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>httpCodeEnum<span style="color:#f92672">.</span><span style="color:#a6e22e">getMsg</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> httpCodeEnum<span style="color:#f92672">.</span><span style="color:#a6e22e">getCode</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">msg</span> <span style="color:#f92672">=</span> httpCodeEnum<span style="color:#f92672">.</span><span style="color:#a6e22e">getMsg</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ol start="2">
<li>å†™ä¸€ä¸ªhandlerå¤„ç†æŠ›å‡ºçš„å¼‚å¸¸</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@RestControllerAdvice</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GlobalExceptionHandler</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@ExceptionHandler</span><span style="color:#f92672">(</span>SystemException<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ResponseResult <span style="color:#a6e22e">systemExceptionHandler</span><span style="color:#f92672">(</span>SystemException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//æ‰“å°å¼‚å¸¸ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        log<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;å‡ºç°äº†å¼‚å¸¸ï¼{}&#34;</span><span style="color:#f92672">,</span>e<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//ä»å¼‚å¸¸å¯¹è±¡ä¸­è·å–æç¤ºä¿¡æ¯å°è£…è¿”å›
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> ResponseResult<span style="color:#f92672">.</span><span style="color:#a6e22e">errorResult</span><span style="color:#f92672">(</span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">getCode</span><span style="color:#f92672">(),</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">getMsg</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*å®šä¹‰ä¸€ä¸ªhandlerå¤„ç†å…¶ä»–å¼‚å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@ExceptionHandler</span><span style="color:#f92672">(</span>Exception<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ResponseResult <span style="color:#a6e22e">ExceptionHandler</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//æ‰“å°å¼‚å¸¸ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        log<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;å‡ºç°äº†å¼‚å¸¸ï¼{}&#34;</span><span style="color:#f92672">,</span>e<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//ä»å¼‚å¸¸å¯¹è±¡ä¸­è·å–æç¤ºä¿¡æ¯å°è£…è¿”å›
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> ResponseResult<span style="color:#f92672">.</span><span style="color:#a6e22e">errorResult</span><span style="color:#f92672">(</span>AppHttpCodeEnum<span style="color:#f92672">.</span><span style="color:#a6e22e">SYSTEM_ERROR</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><code>@Slf4j</code>ï¼šæ‰“å°æ—¥å¿—ä¿¡æ¯çš„æ³¨è§£ï¼Œæ³¨è§£åå¯ä»¥é€šè¿‡log.erroræ‰“å°é”™è¯¯</p>
<h2 id="å…³é—­8080ç«¯å£">å…³é—­8080ç«¯å£<a hidden class="anchor" aria-hidden="true" href="#å…³é—­8080ç«¯å£">#</a></h2>
<p>netstat -o -n -a | findstr :8080
taskkill /F /PID 3116</p>
<h2 id="å¼‚å¸¸å¤„ç†å™¨">å¼‚å¸¸å¤„ç†å™¨<a hidden class="anchor" aria-hidden="true" href="#å¼‚å¸¸å¤„ç†å™¨">#</a></h2>
<h4 id="è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸-1">è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸<a hidden class="anchor" aria-hidden="true" href="#è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸-1">#</a></h4>
<p>ç”¨æ¥æ•è·æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå…¶ä¸­ä¸šåŠ¡å¼‚å¸¸å¤„ç†å™¨éœ€è¦è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    å…¨å±€å¼‚å¸¸å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@ControllerAdvice</span><span style="color:#f92672">(</span>annotations <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>RestController<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> Controller<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">})</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@ResponseBody</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GlobalExceptionHandler</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * å¼‚å¸¸å¤„ç†æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@ExceptionHandler</span><span style="color:#f92672">(</span>SQLIntegrityConstraintViolationException<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> R<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">exceptionHandler</span><span style="color:#f92672">(</span>SQLIntegrityConstraintViolationException ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        log<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>ex<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ex<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">().</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Duplicate entry&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            String<span style="color:#f92672">[]</span> split <span style="color:#f92672">=</span> ex<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">().</span><span style="color:#a6e22e">split</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34; &#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            String msg <span style="color:#f92672">=</span> split<span style="color:#f92672">[</span><span style="color:#ae81ff">2</span><span style="color:#f92672">]</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;å·²å­˜åœ¨&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> R<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> R<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;æœªçŸ¥é”™è¯¯&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * ä¸šåŠ¡å¼‚å¸¸å¤„ç†æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@ExceptionHandler</span><span style="color:#f92672">(</span>CustomExpection<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> R<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">exceptionHandler</span><span style="color:#f92672">(</span>CustomExpection ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        log<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>ex<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> R<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>ex<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomExpection</span> <span style="color:#66d9ef">extends</span> RuntimeException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">CustomExpection</span><span style="color:#f92672">(</span>String message<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">(</span>message<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨æ—¶éœ€è¦æŠ›å‡ºå¼‚å¸¸</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> CustomExpection<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;å½“å‰åˆ†ç±»ä¸‹å…³è”äº†å¥—é¤ï¼Œä¸èƒ½åˆ é™¤&#34;</span><span style="color:#f92672">);</span>
</span></span></code></pre></div><h2 id="ä½¿ç”¨è¿‡æ»¤å™¨å®Œæˆç™»å½•æ ¡éªŒ">ä½¿ç”¨è¿‡æ»¤å™¨å®Œæˆç™»å½•æ ¡éªŒ<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨è¿‡æ»¤å™¨å®Œæˆç™»å½•æ ¡éªŒ">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@WebFilter</span><span style="color:#f92672">(</span>filterName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;loginCheckFilter&#34;</span><span style="color:#f92672">,</span>urlPatterns <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/*&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LoginCheckFilter</span> <span style="color:#66d9ef">implements</span> Filter <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//è·¯å¾„åŒ¹é…å™¨ï¼Œæ”¯æŒé€šé…ç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> AntPathMatcher PATH_MATCHER <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> AntPathMatcher<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>ServletRequest servletRequest<span style="color:#f92672">,</span> ServletResponse servletResponse<span style="color:#f92672">,</span> FilterChain filterChain<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> ServletException <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        HttpServletRequest request <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>HttpServletRequest<span style="color:#f92672">)</span> servletRequest<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        HttpServletResponse response <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>HttpServletResponse<span style="color:#f92672">)</span> servletResponse<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//1ã€è·å–æœ¬æ¬¡è¯·æ±‚çš„URl
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        String requestURl <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestURI</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;æ‹¦æˆªåˆ°è¯·æ±‚ï¼š{}&#34;</span><span style="color:#f92672">,</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestURI</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        String<span style="color:#f92672">[]</span> urls <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">[]{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/employee/login&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/emplyee/logout&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/backend/**&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/front/**&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//2ã€åˆ¤æ–­æœ¬æ¬¡è¯·æ±‚æ˜¯å¦éœ€è¦å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">boolean</span> check <span style="color:#f92672">=</span> check<span style="color:#f92672">(</span>urls<span style="color:#f92672">,</span> requestURl<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//3ã€å¦‚æœä¸éœ€è¦å¤„ç†ç›´æ¥æ”¾è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>check<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            log<span style="color:#f92672">.</span><span style="color:#a6e22e">info</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;æœ¬æ¬¡è¯·æ±‚{}ä¸éœ€è¦å¤„ç†&#34;</span><span style="color:#f92672">,</span> requestURl<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            filterChain<span style="color:#f92672">.</span><span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//4ã€åˆ¤æ–­ç™»å½•çŠ¶æ€ï¼Œå¦‚æœå·²ç™»å½•ï¼Œç›´æ¥æ”¾è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;employee&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Long empId<span style="color:#f92672">=(</span>Long<span style="color:#f92672">)</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;employee&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            BaseContext<span style="color:#f92672">.</span><span style="color:#a6e22e">setCurrentId</span><span style="color:#f92672">(</span>empId<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            filterChain<span style="color:#f92672">.</span><span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//5ã€å¦‚æœæœªç™»å½•åˆ™è¿”å›æœªç™»å½•ç»“æœï¼Œé€šè¿‡è¾“å‡ºæµæ–¹å¼å‘å®¢æˆ·ç«¯é¡µé¢å“åº”æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        response<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">().</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>JSON<span style="color:#f92672">.</span><span style="color:#a6e22e">toJSONString</span><span style="color:#f92672">(</span>R<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;NOTLOGIN&#34;</span><span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">check</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> urls<span style="color:#f92672">,</span> String requestURl<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String url <span style="color:#f92672">:</span> urls<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">boolean</span> match <span style="color:#f92672">=</span> PATH_MATCHER<span style="color:#f92672">.</span><span style="color:#a6e22e">match</span><span style="color:#f92672">(</span>url<span style="color:#f92672">,</span> requestURl<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>match<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="å…¶ä»–">å…¶ä»–<a hidden class="anchor" aria-hidden="true" href="#å…¶ä»–">#</a></h2>
<h4 id="æ¶ˆæ¯è½¬æ¢å™¨">æ¶ˆæ¯è½¬æ¢å™¨<a hidden class="anchor" aria-hidden="true" href="#æ¶ˆæ¯è½¬æ¢å™¨">#</a></h4>
<p>å‰ç«¯jsæ–‡ä»¶å¯¹äºLongå‹æ•°æ®ä¼šäº§ç”Ÿç²¾åº¦ä¸¢å¤±ã€‚è§£å†³æ–¹æ³•ä½¿ç”¨å¯¹è±¡æ˜ å°„å™¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.databind.DeserializationFeature<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.databind.ObjectMapper<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.databind.module.SimpleModule<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.databind.ser.std.ToStringSerializer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateDeserializer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateTimeDeserializer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalTimeDeserializer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateSerializer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalTimeSerializer<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.math.BigInteger<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.LocalDate<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.LocalDateTime<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.LocalTime<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.time.format.DateTimeFormatter<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import static</span> com.fasterxml.jackson.databind.DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * å¯¹è±¡æ˜ å°„å™¨:åŸºäºjacksonå°†Javaå¯¹è±¡è½¬ä¸ºjsonï¼Œæˆ–è€…å°†jsonè½¬ä¸ºJavaå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * å°†JSONè§£æä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹ç§°ä¸º [ä»JSONååºåˆ—åŒ–Javaå¯¹è±¡]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * ä»Javaå¯¹è±¡ç”ŸæˆJSONçš„è¿‡ç¨‹ç§°ä¸º [åºåˆ—åŒ–Javaå¯¹è±¡åˆ°JSON]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">JacksonObjectMapper</span> <span style="color:#66d9ef">extends</span> ObjectMapper <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String DEFAULT_DATE_FORMAT <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;yyyy-MM-dd&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String DEFAULT_DATE_TIME_FORMAT <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String DEFAULT_TIME_FORMAT <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HH:mm:ss&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">JacksonObjectMapper</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">super</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//æ”¶åˆ°æœªçŸ¥å±æ€§æ—¶ä¸æŠ¥å¼‚å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">configure</span><span style="color:#f92672">(</span>FAIL_ON_UNKNOWN_PROPERTIES<span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//ååºåˆ—åŒ–æ—¶ï¼Œå±æ€§ä¸å­˜åœ¨çš„å…¼å®¹å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getDeserializationConfig</span><span style="color:#f92672">().</span><span style="color:#a6e22e">withoutFeatures</span><span style="color:#f92672">(</span>DeserializationFeature<span style="color:#f92672">.</span><span style="color:#a6e22e">FAIL_ON_UNKNOWN_PROPERTIES</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        SimpleModule simpleModule <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SimpleModule<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">addDeserializer</span><span style="color:#f92672">(</span>LocalDateTime<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> LocalDateTimeDeserializer<span style="color:#f92672">(</span>DateTimeFormatter<span style="color:#f92672">.</span><span style="color:#a6e22e">ofPattern</span><span style="color:#f92672">(</span>DEFAULT_DATE_TIME_FORMAT<span style="color:#f92672">)))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">addDeserializer</span><span style="color:#f92672">(</span>LocalDate<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> LocalDateDeserializer<span style="color:#f92672">(</span>DateTimeFormatter<span style="color:#f92672">.</span><span style="color:#a6e22e">ofPattern</span><span style="color:#f92672">(</span>DEFAULT_DATE_FORMAT<span style="color:#f92672">)))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">addDeserializer</span><span style="color:#f92672">(</span>LocalTime<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> LocalTimeDeserializer<span style="color:#f92672">(</span>DateTimeFormatter<span style="color:#f92672">.</span><span style="color:#a6e22e">ofPattern</span><span style="color:#f92672">(</span>DEFAULT_TIME_FORMAT<span style="color:#f92672">)))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">addSerializer</span><span style="color:#f92672">(</span>BigInteger<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> ToStringSerializer<span style="color:#f92672">.</span><span style="color:#a6e22e">instance</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">addSerializer</span><span style="color:#f92672">(</span>Long<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> ToStringSerializer<span style="color:#f92672">.</span><span style="color:#a6e22e">instance</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">addSerializer</span><span style="color:#f92672">(</span>LocalDateTime<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> LocalDateTimeSerializer<span style="color:#f92672">(</span>DateTimeFormatter<span style="color:#f92672">.</span><span style="color:#a6e22e">ofPattern</span><span style="color:#f92672">(</span>DEFAULT_DATE_TIME_FORMAT<span style="color:#f92672">)))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">addSerializer</span><span style="color:#f92672">(</span>LocalDate<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> LocalDateSerializer<span style="color:#f92672">(</span>DateTimeFormatter<span style="color:#f92672">.</span><span style="color:#a6e22e">ofPattern</span><span style="color:#f92672">(</span>DEFAULT_DATE_FORMAT<span style="color:#f92672">)))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">addSerializer</span><span style="color:#f92672">(</span>LocalTime<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> LocalTimeSerializer<span style="color:#f92672">(</span>DateTimeFormatter<span style="color:#f92672">.</span><span style="color:#a6e22e">ofPattern</span><span style="color:#f92672">(</span>DEFAULT_TIME_FORMAT<span style="color:#f92672">)));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//æ³¨å†ŒåŠŸèƒ½æ¨¡å— ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">registerModule</span><span style="color:#f92672">(</span>simpleModule<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>å¹¶åœ¨WebConfigä¸­é…ç½®</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WebConfig</span> <span style="color:#66d9ef">extends</span> WebMvcConfigurationSupport <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *è®¾ç½®é™æ€èµ„æºæ˜ å°„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addResourceHandlers</span><span style="color:#f92672">(</span>ResourceHandlerRegistry registry<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        registry<span style="color:#f92672">.</span><span style="color:#a6e22e">addResourceHandler</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/backend/**&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">addResourceLocations</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;classpath:/backend/&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        registry<span style="color:#f92672">.</span><span style="color:#a6e22e">addResourceHandler</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/front/**&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">addResourceLocations</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/classpath:/front&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">extendMessageConverters</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>HttpMessageConverter<span style="color:#f92672">&lt;?&gt;&gt;</span> converters<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//åˆ›å»ºæ¶ˆæ¯è½¬åŒ–å™¨å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        MappingJackson2HttpMessageConverter messageConverter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MappingJackson2HttpMessageConverter<span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//è®¾ç½®å¯¹è±¡è½¬æ¢å™¨ï¼Œåº•å±‚ä½¿ç”¨Jacksonå°†å¯¹è±¡è½¬æ¢ä¸ºjson
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        messageConverter<span style="color:#f92672">.</span><span style="color:#a6e22e">setObjectMapper</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> JacksonObjectMapper<span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//å°†ä¸Šé¢çš„æ¶ˆæ¯è½¬æ¢å™¨å¯¹è±¡è¿½åŠ åˆ°mvcæ¡†æ¶çš„è½¬æ¢å™¨é›†åˆä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        converters<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#ae81ff">0</span><span style="color:#f92672">,</span> messageConverter<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="threadlocal">ThreadLocal<a hidden class="anchor" aria-hidden="true" href="#threadlocal">#</a></h4>
<p>ThreadLoacalå¹¶ä¸æ˜¯ä¸€ä¸ªThreadï¼Œè€Œæ˜¯Threadçš„å±€éƒ¨å˜é‡ã€‚å½“ä½¿ç”¨ThreadLocalç»´æŠ¤å˜é‡æ—¶ï¼ŒThreadLocalä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹çš„æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹æ‰€å¯¹åº”çš„å‰¯æœ¬ã€‚ThreadLocalä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›å•ç‹¬ä¸€ä»½å­˜å‚¨ç©ºé—´ï¼Œå…·æœ‰çº¿ç¨‹éš”ç¦»çš„æ•ˆæœï¼Œåªæœ‰åœ¨çº¿ç¨‹å†…æ‰èƒ½è·å–ç›¸åº”çš„å€¼ï¼Œçº¿ç¨‹å¤–åˆ™ä¸èƒ½è®¿é—®</p>
<p>ThreadLocalå¸¸ç”¨æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>T value<span style="color:#f92672">)</span> <span style="color:#75715e">//è®¾ç½®å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> T <span style="color:#a6e22e">get</span><span style="color:#f92672">()</span>           <span style="color:#75715e">//è¿”å›å½“å‰çº¿ç¨‹æ‰€å¯¹åº”çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼
</span></span></span></code></pre></div><p>ä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BaseContext</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> ThreadLocal<span style="color:#f92672">&lt;</span>Long<span style="color:#f92672">&gt;</span> threadLocal <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ThreadLocal<span style="color:#f92672">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setCurrentId</span><span style="color:#f92672">(</span>Long id<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        threadLocal<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>id<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Long <span style="color:#a6e22e">getCurrentId</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> threadLocal<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h4 id="é™æ€èµ„æºæ˜ å°„">é™æ€èµ„æºæ˜ å°„<a hidden class="anchor" aria-hidden="true" href="#é™æ€èµ„æºæ˜ å°„">#</a></h4>
<p>ç”±äºåªèƒ½è®¿é—®staticæ–‡ä»¶ä¸‹çš„é™æ€èµ„æºï¼Œå½“éœ€è¦è®¿é—®å…¶ä»–æ–‡ä»¶å¤¹ä¸‹çš„é™æ€èµ„æºéœ€è¦åœ¨WebConfigé‡Œè®¾ç½®é™æ€èµ„æºæ˜ å°„</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WebConfig</span> <span style="color:#66d9ef">extends</span> WebMvcConfigurationSupport <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     *è®¾ç½®é™æ€èµ„æºæ˜ å°„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addResourceHandlers</span><span style="color:#f92672">(</span>ResourceHandlerRegistry registry<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        registry<span style="color:#f92672">.</span><span style="color:#a6e22e">addResourceHandler</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/backend/**&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">addResourceLocations</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;classpath:/backend/&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>        registry<span style="color:#f92672">.</span><span style="color:#a6e22e">addResourceHandler</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/front/**&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">addResourceLocations</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/classpath:/front&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="spring-cache">Spring Cache<a hidden class="anchor" aria-hidden="true" href="#spring-cache">#</a></h2>
<p><code>@EnableCaching </code>ï¼šå¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</p>
<p>åœ¨controlleræ–¹æ³•ä¸ŠåŠ å…¥ä»¥ä¸‹æ³¨è§£ï¼š</p>
<p><code>@Cacheable</code>ï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰springå…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®åˆ™ç›´æ¥è¿”å›æ•°æ®ï¼›è‹¥æ²¡æœ‰æ•°æ®ï¼Œè°ƒç”¨æ–¹æ³•å¹¶å°†è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­(value=&quot;?&quot;,key=&quot;#result.?&quot;,unless=&ldquo;result==null&rdquo;)ï¼Œunlessæ»¡è¶³æ¡ä»¶ä¸ç¼“å­˜</p>
<p><code>@CachePut</code>ï¼šå°†æ–¹æ³•çš„è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­(value=&quot;?&quot;,key=&quot;#result.?&quot;),valueæ˜¯æŒ‡ç¼“å­˜çš„åç§°ï¼Œkeyæ˜¯ç¼“å­˜çš„é”®</p>
<p><code>@CacheEvict</code>ï¼šå°†ä¸€æ¡æˆ–å¤šæ¡æ•°æ®ä»ç¼“å­˜ä¸­åˆ é™¤(value=&quot;?&quot;,key=&quot;#root.args[0]&quot; or &ldquo;#id&rdquo;)ï¼ŒallEntries = trueåˆ é™¤è¿™ä¸ªåˆ†ç±»ä¸‹æ‰€æœ‰çš„ç¼“å­˜æ•°æ®</p>
<p>åœ¨å¯åŠ¨ç±»ä¸Šä½¿ç”¨@EnableCachingå¼€å¯ç¼“å­˜æ”¯æŒ</p>
<p>ä½¿ç”¨redisä½œä¸ºç¼“å­˜æŠ€æœ¯ï¼Œåªéœ€è¦å¯¼å…¥Spring data Redis çš„mavenåæ ‡:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span> <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-cache<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>é…ç½®redis=ã€‹application.yml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#f92672">spring</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">cache</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">redis</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#ae81ff">time-to-live:1800000#è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸms</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> CacheManager cacheManaget
</span></span></code></pre></div><h2 id="swagger">swagger<a hidden class="anchor" aria-hidden="true" href="#swagger">#</a></h2>
<p>1ã€å¯¼å…¥ä¾èµ–</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>     <span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;groupId&gt;</span>com.github.xiaoymin<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;artifactId&gt;</span>knife4j-spring-boot-starter<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;version&gt;</span>3.0.2<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>2ã€å¯¼å…¥knife4jç›¸å…³é…ç½®ï¼ˆWebMvcConfigï¼‰</p>
<p>@EnableSwagger2</p>
<p>@EnableKnife4j</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Docket <span style="color:#a6e22e">createRestApi</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//æ–‡æ¡£ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Docket<span style="color:#f92672">(</span>DocumentationType<span style="color:#f92672">.</span><span style="color:#a6e22e">SWAGGER_2</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">apiInfo</span><span style="color:#f92672">(</span>apiInfo<span style="color:#f92672">())</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">select</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">apis</span><span style="color:#f92672">(</span>RequestHandlerSelectors<span style="color:#f92672">.</span><span style="color:#a6e22e">basePackage</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;com.itheima.reggie.controller&#34;</span><span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">paths</span><span style="color:#f92672">(</span>PathSelectors<span style="color:#f92672">.</span><span style="color:#a6e22e">any</span><span style="color:#f92672">())</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> ApiInfo <span style="color:#a6e22e">apiInfo</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ApiInfoBuilder<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">title</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ç‘å‰å¤–å–&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">version</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;1.0&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">description</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ç‘å‰å¤–å–æ¥å£æ–‡æ¡£&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span></code></pre></div><p>3ã€è®¾ç½®é™æ€èµ„æºæ˜ å°„</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> registry<span style="color:#f92672">.</span><span style="color:#a6e22e">addResourceHandler</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;doc.html&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">addResourceLocations</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;classpath:/META-INF/resources/&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span> registry<span style="color:#f92672">.</span><span style="color:#a6e22e">addResourceHandler</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/webjars/**&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">addResourceLocations</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;classpath:/META-INF/resources/webjars/&#34;</span><span style="color:#f92672">);</span>
</span></span></code></pre></div><p>4ã€è¿‡æ»¤å™¨ä¸­è®¾ç½®ä¸éœ€è¦å¤„ç†çš„è¯·æ±‚è·¯å¾„</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        String<span style="color:#f92672">[]</span> urls <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">[]{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/employee/login&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/employee/logout&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/backend/**&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/front/**&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/common/**&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/user/sendMsg&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/user/login&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/doc.html&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/webjars/**&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/swagger-resources&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;/v2/api-docs&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">};</span>
</span></span></code></pre></div><h4 id="swaggerapi">swaggerApi<a hidden class="anchor" aria-hidden="true" href="#swaggerapi">#</a></h4>
<p><img loading="lazy" src="/img/blog%e7%ac%94%e8%ae%b0/swaggerApi.png" alt="swaggerApi"  />
</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="answerboom.github.io/tags/java/">Java</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="answerboom.github.io">ğŸ» liyBlog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0-rc.1/katex.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0-rc.1/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0-rc.1/contrib/auto-render.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
              delimiters: [
                  {left: "$$", right: "$$", display: true},
                  {left: "$", right: "$", display: false}
              ]
          });
    });
</script>
</body>

</html>
